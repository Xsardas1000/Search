Dynamic Memory Networks for Visual and Textual Question Answering

Caiming Xiong*, Stephen Merity*, Richard Socher
MetaMind, Palo Alto, CA USA

{CMXIONG,SMERITY,RICHARD}METAMIND.IO
*indicates equal contribution.

6
1
0
2

 
r
a

M
4

 

 
 
]
E
N
.
s
c
[
 
 

1
v
7
1
4
1
0

.

3
0
6
1
:
v
i
X
r
a

Abstract

Neural network architectures with memory and
attention mechanisms exhibit certain reason-
ing capabilities required for question answering.
One such architecture, the dynamic memory net-
work (DMN), obtained high accuracy on a vari-
ety of language tasks. However, it was not shown
whether the architecture achieves strong results
for question answering when supporting facts are
not marked during training or whether it could
be applied to other modalities such as images.
Based on an analysis of the DMN, we propose
several improvements to its memory and input
modules. Together with these changes we intro-
duce a novel input module for images in order
to be able to answer visual questions. Our new
DMN+ model improves the state of the art on
both the Visual Question Answering dataset and
the bAbI-10k text question-answering dataset
without supporting fact supervision.

1. Introduction
Neural network based methods have made tremendous
progress in image and text classiﬁcation (Krizhevsky et al.,
2012; Socher et al., 2013b). However, only recently has
progress been made on more complex tasks that require
logical reasoning. This success is based in part on the
addition of memory and attention components to complex
neural networks. For instance, memory networks (Weston
et al., 2015b) are able to reason over several facts written in
natural language or (subject, relation, object) triplets. At-
tention mechanisms have been successful components in
both machine translation (Bahdanau et al., 2015; Luong
et al., 2015) and image captioning models (Xu et al., 2015).
The dynamic memory network (Kumar et al., 2015)
(DMN) is one example of a neural network model that has
both a memory component and an attention mechanism.
The DMN yields state of the art results on question answer-
ing with supporting facts marked during training, sentiment
analysis, and part-of-speech tagging.
We analyze the DMN components, speciﬁcally the input

Figure 1. Question Answering over text and images using a Dy-
namic Memory Network.

module and memory module, to improve question answer-
ing. We propose a new input module which uses a two
level encoder with a sentence reader and input fusion layer
to allow for information ﬂow between sentences. For the
memory, we propose a modiﬁcation to gated recurrent units
(GRU) (Chung et al., 2014). The new GRU formulation in-
corporates attention gates that are computed using global
knowledge over the facts. Unlike before, the new DMN+
model does not require that supporting facts (i.e. the facts
that are relevant for answering a particular question) are
labeled during training. The model learns to select the im-
portant facts from a larger set.
In addition, we introduce a new input module to represent
images. This module is compatible with the rest of the
DMN architecture and its output is fed into the memory
module. We show that the changes in the memory module
that improved textual question answering also improve vi-
sual question answering. Both tasks are illustrated in Fig. 1.

2. Dynamic Memory Networks
We begin by outlining the DMN for question answering
and the modules as presented in Kumar et al. (2015).
The DMN is a general architecture for question answering
(QA). It is composed of modules that allow different as-
pects such as input representations or memory components
to be analyzed and improved independently. The modules,
depicted in Fig. 1, are as follows:

AnswerQuestionInput ModuleAnswerQuestionInput Module(a) Text Question-Answering(b) Visual Question-AnsweringWhat kind of tree is in the background?KitchenPalmJohn moved to the garden.John got the apple there.John moved to the kitchen.Sandra got the milk there.John dropped the apple.John moved to the ofﬁce.Where is theapple?Episodic MemoryAttention MechanismMemory UpdateEpisodic MemoryAttention MechanismMemory UpdateDynamic Memory Networks for Visual and Textual Question Answering

(cid:16)
(cid:16)

W (u)xi + U (u)hi−1 + b(u)(cid:17)
W (r)xi + U (r)hi−1 + b(r)(cid:17)
W xi + ri ◦ U hi−1 + b(h)(cid:17)
(cid:16)

(1)

(2)

(3)

Input Module: This module processes the input data about
which a question is being asked into a set of vectors termed
facts, represented as F = [f1, . . . , fN ], where N is the total
number of facts. These vectors are ordered, resulting in ad-
ditional information that can be used by later components.
For text QA in Kumar et al. (2015), the module consists of
a GRU over the input words.
As the GRU is used in many components of the DMN, it
is useful to provide the full deﬁnition. For each time step i
with input xi and previous hidden state hi−1, we compute
the updated hidden state hi = GRU (xi, hi−1) by

ui = σ

ri = σ

˜hi = tanh
hi = ui ◦ ˜hi + (1 − ui) ◦ hi−1

(4)
where σ is the sigmoid activation function, ◦ is an element-
wise product, W (z), W (r), W ∈ RnH×nI , U (z), U (r), U ∈
RnH×nH , nH is the hidden size, and nI is the input size.
Question Module: This module computes a vector repre-
sentation q of the question, where q ∈ RnH is the ﬁnal
hidden state of a GRU over the words in the question.
Episodic Memory Module: Episode memory aims to re-
trieve the information required to answer the question q
from the input facts. To improve our understanding of
both the question and input, especially if questions require
transitive reasoning, the episode memory module may pass
over the input multiple times, updating episode memory af-
ter each pass. We refer to the episode memory on the tth
pass over the inputs as mt, where mt ∈ RnH , the initial
memory vector is set to the question vector: m0 = q.
The episodic memory module consists of two separate
components: the attention mechanism and the memory up-
date mechanism. The attention mechanism is responsible
for producing a contextual vector ct, where ct ∈ RnH
is a summary of relevant input for pass t, with relevance
inferred by the question q and previous episode memory
mt−1. The memory update mechanism is responsible for
generating the episode memory mt based upon the contex-
tual vector ct and previous episode memory mt−1. By the
ﬁnal pass T , the episodic memory mT should contain all
the information required to answer the question q.
Answer Module: The answer module receives both q and
mT to generate the model’s predicted answer. For simple
answers, such as a single word, a linear layer with softmax
activation may be used. For tasks requiring a sequence out-
put, an RNN may be used to decode a = [q; mT ], the con-
catenation of vectors q and mT , to an ordered set of tokens.
The cross entropy error on the answers is used for training

and backpropagated through the entire network.

3. Improved Dynamic Memory Networks:

DMN+

We propose and compare several modeling choices for two
crucial components: input representation, attention mecha-
nism and memory update. The ﬁnal DMN+ model obtains
the highest accuracy on the bAbI-10k dataset without sup-
porting facts and the VQA dataset (Antol et al., 2015). Sev-
eral design choices are motivated by intuition and accuracy
improvements on that dataset.

3.1. Input Module for Text QA

In the DMN speciﬁed in Kumar et al. (2015), a single GRU
is used to process all the words in the story, extracting sen-
tence representations by storing the hidden states produced
at the end of sentence markers. The GRU also provides a
temporal component by allowing a sentence to know the
content of the sentences that came before them. Whilst
this input module worked well for bAbI-1k with supporting
facts, as reported in Kumar et al. (2015), it did not perform
well on bAbI-10k without supporting facts (Sec. 6.1).
We speculate that there are two main reasons for this per-
formance disparity, all exacerbated by the removal of sup-
porting facts. First, the GRU only allows sentences to
have context from sentences before them, but not after
them. This prevents information propagation from future
sentences. Second, the supporting sentences may be too
far away from each other on a word level to allow for these
distant sentences to interact through the word level GRU.
Input Fusion Layer
For the DMN+, we propose replacing this single GRU with
two different components. The ﬁrst component is a sen-
tence reader, responsible only for encoding the words into
a sentence embedding. The second component is the input
fusion layer, allowing for interactions between sentences.
This resembles the hierarchical neural auto-encoder archi-
tecture of Li et al. (2015) and allows content interaction
between sentences. We adopt the bi-directional GRU for
this input fusion layer because it allows information from
both past and future sentences to be used. As gradients
do not need to propagate through the words between sen-
tences, the fusion layer also allows for distant supporting
sentences to have a more direct interaction.
Fig. 2 shows an illustration of an input module, where a
positional encoder is used for the sentence reader and a
bi-directional GRU is adopted for the input fusion layer.
Each sentence encoding fi is the output of an encoding
scheme taking the word tokens [wi
Mi], where Mi
is the length of the sentence.

1, . . . , wi

Dynamic Memory Networks for Visual and Textual Question Answering

Figure 2. The input module with a “fusion layer”, where the sen-
tence reader encodes the sentence and the bi-directional GRU al-
lows information to ﬂow between sentences.

sentation is produced by fi = (cid:80)j=1

The sentence reader could be based on any variety of
encoding schemes. We selected positional encoding de-
scribed in Sukhbaatar et al. (2015) to allow for a compari-
son to their work. GRUs and LSTMs were also considered
but required more computational resources and were prone
to overﬁtting if auxiliary tasks, such as reconstructing the
original sentence, were not used.
For the positional encoding scheme, the sentence repre-
j, where ◦ is
element-wise multiplication and lj is a column vector with
structure ljd = (1 − j/M ) − (d/D)(1 − 2j/M ), where
d is the embedding index and D is the dimension of the
embedding.
The input fusion layer takes these input facts and enables
an information exchange between them by applying a bi-
directional GRU.

M lj ◦ wi

−→fi = GRUf wd(fi,−−→fi−1)
←−fi = GRUbwd(fi,←−−fi+1)
←→fi = ←−fi + −→fi

(5)
(6)
(7)
where fi is the input fact at timestep i, −→fi is the hidden state
of the forward GRU at timestep i, and ←−fi is the hidden state
of the backward GRU at timestep i. This allows contextual
information from both future and past facts to impact ←→fi .
We explored a variety of encoding schemes for the sen-
tence reader, including GRUs, LSTMs, and the positional
encoding scheme described in Sukhbaatar et al. (2015).
For simplicity and speed, we selected the positional en-
coding scheme. GRUs and LSTMs were also considered
but required more computational resources and were prone
to overﬁtting if auxiliary tasks, such as reconstructing the

Figure 3. VQA input module to represent images for the DMN.

original sentence, were not used.

3.2. Input Module for VQA

To apply the DMN to visual question answering, we intro-
duce a new input module for images. The module splits
an image into small local regions and considers each re-
gion equivalent to a sentence in the input module for text.
The input module for VQA is composed of three parts, il-
lustrated in Fig. 3: local region feature extraction, visual
feature embedding, and the input fusion layer introduced
in Sec. 3.1.
Local region feature extraction: To extract features
from the image, we use a convolutional neural network
(Krizhevsky et al., 2012) based upon the VGG-19 model
(Simonyan & Zisserman, 2014). We ﬁrst rescale the input
image to 448 × 448 and take the output from the last pool-
ing layer which has dimensionality d = 512 × 14 × 14.
The pooling layer divides the image into a grid of 14 × 14,
resulting in 196 local regional vectors of d = 512.
Visual feature embedding: As the VQA task involves
both image features and text features, we add a linear layer
with tanh activation to project the local regional vectors to
the textual feature space used by the question vector q.
Input fusion layer: The local regional vectors extracted
from above do not yet have global information available
to them. Without global information, their representational
power is quite limited, with simple issues like object scal-
ing or locational variance causing accuracy problems.
To solve this, we add an input fusion layer similar to that
of the textual input module described in Sec. 3.1. First,
to produce the input facts F , we traverse the image in a
snake like fashion, as seen in Figure 3. We then apply a
bi-directional GRU over these input facts F to produce the

Input fusionlayerSentencereaderFactsGRUf1f1w1w2w3w4GRUPositional EncoderGRUf2f2w1w2w3w4GRUPositional EncoderGRUf3f3w1w2w3w4GRUPositional Encoder 1 1 1 1 2 2 2 2 3 3 3 3Textual Input Module5121414WCNNVisual feature extractionFeature embeddingInput fusion layerVisual Input ModuleGRUf1GRUGRUf2GRUGRUf196GRUWW. . .. . .FactsDynamic Memory Networks for Visual and Textual Question Answering

Figure 5. (a) The traditional GRU model, and (b) the proposed
attention-based GRU model

Figure 4. The episodic memory module of the DMN+ when using
two passes. The

←→
F is the output of the input module.

globally aware input facts ←→F . The bi-directional GRU al-
lows for information propagation from neighboring image
patches, capturing spatial information.

3.3. The Episodic Memory Module

The episodic memory module, as depicted in Fig. 4, re-
trieves information from the input facts ←→F = [←→f1 , . . . ,←→fN ]
provided to it by focusing attention on a subset of these
facts. We implement this attention by associating a sin-
i, with each fact ←→f i
gle scalar value, the attention gate gt
during pass t. This is computed by allowing interactions
between the fact and both the question representation and
the episode memory state.

(10)

(cid:16)

i + b(1)(cid:17)

Z t

gt
i =

+ b(2)

(8)
(9)

W (1)zt

i =[←→fi ◦ q;←→fi ◦ mt−1;|←→fi − q|;|←→fi − mt−1|]
zt
i =W (2) tanh
(cid:80)Mi
exp(Z t
i )
k=1 exp(Z t
k)
where ←→fi
is the ith fact, mt−1 is the previous episode
memory, q is the original question, ◦ is the element-wise
product, | · | is the element-wise absolute value, and ; rep-
resents concatenation of the vectors.
The DMN implemented in Kumar et al. (2015) involved
a more complex set of interactions within z, containing
the additional terms [f ; mt−1; q; f T W (b)q; f T W (b)mt−1].
After an initial analysis, we found these additional terms
were not required.
Attention Mechanism
Once we have the attention gate gt
i we use an attention
mechanism to extract a contextual vector ct based upon the
current focus. We focus on two types of attention: soft at-
tention and a new attention based GRU. The latter improves
performance and is hence the ﬁnal modeling choice for the
DMN+.

i=1 gt

(cid:80)N

Soft attention: Soft attention produces a contextual vec-
tor ct through a weighted summation of the sorted list of
vectors ←→F and corresponding attention gates gt
i: ct =
i←→f i This method has two advantages. First, it is
easy to compute. Second, if the softmax activation is spiky
it can approximate a hard attention function by selecting
only a single fact for the contextual vector whilst still being
differentiable. However the main disadvantage to soft at-
tention is that the summation process loses both positional
and ordering information. Whilst multiple attention passes
can retrieve some of this information, this is inefﬁcient.
Attention based GRU: For more complex queries, we
would like for the attention mechanism to be sensitive to
both the position and ordering of the input facts ←→F . An
RNN would be advantageous in this situation except they
cannot make use of the attention gate from Equation 10.
We propose a modiﬁcation to the GRU architecture by em-
bedding information from the attention mechanism. The
update gate ui in Equation 1 decides how much of each di-
mension of the hidden state to retain and how much should
be updated with the transformed input xi from the current
timestep. As ui is computed using only the current input
and the hidden state from previous timesteps, it lacks any
knowledge from the question or previous episode memory.
By replacing the update gate ui in the GRU (Equation 1)
with the output of the attention gate gt
i (Equation 10) in
Equation 4, the GRU can now use the attention gate for
updating its internal state. This change is depicted in Fig 5.

(11)

hi =gt

i ◦ ˜hi + (1 − gt
i ) ◦ hi−1
i is a scalar, generated
An important consideration is that gt
using a softmax activation, as opposed to the vector ui ∈
RnH , generated using a sigmoid activation. This allows
us to easily visualize how the attention gates activate over
the input, later shown for visual QA in Fig. 6. Though
not explored, replacing the softmax activation in Equation
i ∈ RnH .
10 with a sigmoid activation would result in gt
To produce the contextual vector ct used for updating the
episodic memory state mt, we use the ﬁnal hidden state of
the attention based GRU.
Episode Memory Updates
After each pass through the attention mechanism, we wish

c1c1m0m0AttnGRUGate AttentionAttnGRUAttnGRU. . .Attention MechanismMemory Updatem1m1 !F !Fm2m2AttnGRUGate AttentionAttnGRUAttnGRU. . .Attention MechanismMemory Update. . .. . .c2c2Episodic Memory Pass 1Episodic Memory Pass 2. . .. . .hi˜hiriuiINOUThi˜hiriINOUTgti(a)(b) Dynamic Memory Networks for Visual and Textual Question Answering

to update the episode memory mt−1 with the newly con-
structed contextual vector ct, producing mt. In the DMN,
a GRU with the initial hidden state set to the question vec-
tor q is used for this purpose. The episodic memory for
pass t is computed by

mt = GRU (ct, mt−1)

(12)

The work of Sukhbaatar et al. (2015) suggests that using
different weights for each pass through the episodic mem-
ory may be advantageous. When the model contains only
one set of weights for all episodic passes over the input, it
is referred to as a tied model, as in the “Mem Weights” row
in Table 1.
Following the memory update component used in
Sukhbaatar et al. (2015) and Peng et al. (2015) we experi-
ment with using a ReLU layer for the memory update, cal-
culating the new episode memory state by

mt = ReLU(cid:0)W t[mt−1; ct; q] + b(cid:1)

(13)
where ; is the concatenation operator, W t ∈ RnH×nH , b ∈
RnH , and nH is the hidden size. The untying of weights
and using this ReLU formulation for the memory update
improves accuracy by another 0.5% as shown in Table 1 in
the last column. The ﬁnal output of the memory network is
passed to the answer module as in the original DMN.

4. Related Work
The DMN is related to two major lines of recent work:
memory and attention mechanisms. We work on both vi-
sual and textual question answering which have, until now,
been developed in separate communities.
Neural Memory Models The earliest recent work with a
memory component that is applied to language processing
is that of memory networks (Weston et al., 2015b) which
adds a memory component for question answering over
simple facts. They are similar to DMNs in that they also
have input, scoring, attention and response mechanisms.
However, unlike the DMN their input module computes
sentence representations independently and hence cannot
easily be used for other tasks such as sequence labeling.
Like the original DMN, this memory network requires that
supporting facts are labeled during QA training. End-to-
end memory networks (Sukhbaatar et al., 2015) do not have
this limitation.
In contrast to previous memory models
with a variety of different functions for memory attention
retrieval and representations, DMNs (Kumar et al., 2015)
have shown that neural sequence models can be used for
input representation, attention and response mechanisms.
Sequence models naturally capture position and temporal-
ity of both the inputs and transitive reasoning steps.

Neural Attention Mechanisms Attention mechanisms al-
low neural network models to use a question to selectively
pay attention to speciﬁc inputs. They can beneﬁt image
classiﬁcation (Stollenga et al., 2014), generating captions
for images (Xu et al., 2015), among others mentioned be-
low, and machine translation (Cho et al., 2014; Bahdanau
et al., 2015; Luong et al., 2015). Other recent neural ar-
chitectures with memory or attention which have proposed
include neural Turing machines (Graves et al., 2014), neu-
ral GPUs (Kaiser & Sutskever, 2015) and stack-augmented
RNNs (Joulin & Mikolov, 2015).
Question Answering in NLP Question answering involv-
ing natural language can be solved in a variety of ways to
which we cannot all do justice. If the potential input is a
large text corpus, QA becomes a combination of informa-
tion retrieval and extraction (Yates et al., 2007). Neural
approaches can include reasoning over knowledge bases,
(Bordes et al., 2012; Socher et al., 2013a) or directly via
sentences for trivia competitions (Iyyer et al., 2014).
Visual Question Answering (VQA) In comparison to QA
in NLP, VQA is still a relatively young task that is feasible
only now that objects can be identiﬁed with high accuracy.
The ﬁrst large scale database with unconstrained questions
about images was introduced by Antol et al. (2015). While
VQA datasets existed before they did not include open-
ended, free-form questions about general images (Geman
et al., 2014). Others are were too small to be viable for a
deep learning approach (Malinowski & Fritz, 2014). The
only VQA model which also has an attention component
is the stacked attention network (Yang et al., 2015). Their
work also uses CNN based features. However, unlike our
input fusion layer, they use a single layer neural network
to map the features of each patch to the dimensionality of
the question vector. Hence, the model cannot easily incor-
porate adjacency of local information in its hidden state.
A model that also uses neural modules, albeit logically in-
spired ones, is that by Andreas et al. (2016) who evaluate
on knowledgebase reasoning and visual question answer-
ing. We compare directly to their method on the latter task
and dataset.
Related to visual question answering is the task of describ-
ing images with sentences (Kulkarni et al., 2011). Socher
et al. (2014) used deep learning methods to map images and
sentences into the same space in order to describe images
with sentences and to ﬁnd images that best visualize a sen-
tence. This was the ﬁrst work to map both modalities into
a joint space with deep learning methods, but it could only
select an existing sentence to describe an image. Shortly
thereafter, recurrent neural networks were used to generate
often novel sentences based on images (Karpathy & Fei-
Fei, 2015; Chen & Zitnick, 2014; Fang et al., 2015; Xu
et al., 2015).

Dynamic Memory Networks for Visual and Textual Question Answering

5. Datasets
To analyze our proposed model changes and compare
our performance with other architectures, we use three
datasets.

5.1. bAbI-10k

For evaluating the DMN on textual question answering, we
use bAbI-10k English (Weston et al., 2015a), a synthetic
dataset which features 20 different tasks. Each example is
composed of a set of facts, a question, the answer, and the
supporting facts that lead to the answer. The dataset comes
in two sizes, referring to the number of training examples
each task has: bAbI-1k and bAbI-10k. The experiments in
Sukhbaatar et al. (2015) found that their lowest error rates
on the smaller bAbI-1k dataset were on average three times
higher than on bAbI-10k.

5.2. DAQUAR-ALL visual dataset

The DAtaset for QUestion Answering on Real-world im-
ages (DAQUAR) (Malinowski & Fritz, 2014) consists of
795 training images and 654 test images. Based upon these
images, 6,795 training questions and 5,673 test questions
were generated. Following the previously deﬁned experi-
mental method, we exclude multiple word answers (Mali-
nowski et al., 2015; Ma et al., 2015). The resulting dataset
covers 90% of the original data. The evaluation method
uses classiﬁcation accuracy over the single words. We use
this as a development dataset for model analysis (Sec. 6.1).

5.3. Visual Question Answering

The Visual Question Answering (VQA) dataset was con-
structed using the Microsoft COCO dataset (Lin et al.,
2014) which contained 123,287 training/validation images
and 81,434 test images. Each image has several related
questions with each question answered by multiple people.
This dataset contains 248,349 training questions, 121,512
validation questions, and 244,302 for testing. The testing
data was split into test-development, test-standard and test-
challenge in Antol et al. (2015).
Evaluation on both test-standard and test-challenge are im-
plemented via a submission system. test-standard may only
be evaluated 5 times and test-challenge is only evaluated at
the end of the competition. To the best of our knowledge,
VQA is the largest and most complex image dataset for the
visual question answering task.

6. Experiments
6.1. Model Analysis

To understand the impact of the proposed module changes,
we analyze the performance of a variety of DMN models
on textual and visual question answering datasets.
The original DMN (ODMN) is the architecture presented
in Kumar et al. (2015) without any modiﬁcations. DMN2
only replaces the input module with the input fusion layer
(Sec. 3.1). DMN3, based upon DMN2, replaces the soft at-
tention mechanism with the attention based GRU proposed
in Sec. 3.3. Finally, DMN+, based upon DMN3, is an un-
tied model, using a unique set of weights for each pass and
a linear layer with a ReLU activation to compute the mem-
ory update. We report the performance of the model varia-
tions in Table 1.
A large improvement to accuracy on both the bAbI-10k tex-
tual and DAQUAR visual datasets results from updating the
input module, seen when comparing ODMN to DMN2. On
both datasets, the input fusion layer improves interaction
between distant facts. In the visual dataset, this improve-
ment is purely from providing contextual information from
neighboring image patches, allowing it to handle objects
of varying scale or questions with a locality aspect. For the
textual dataset, the improved interaction between sentences
likely helps the path ﬁnding required for logical reasoning
when multiple transitive steps are required.
The addition of the attention GRU in DMN3 helps answer
questions where complex positional or ordering informa-
tion may be required. This change impacts the textual
dataset the most as few questions in the visual dataset are
likely to require this form of logical reasoning. Finally, the
untied model in the DMN+ overﬁts on some tasks com-
pared to DMN3, but on average the error rate decreases.
From these experimental results, we ﬁnd that the combina-
tion of all the proposed model changes results, culminating
in DMN+, achieves the highest performance across both
the visual and textual datasets.

6.2. Comparison to state of the art using bAbI-10k

We trained our models using the Adam optimizer (Kingma
& Ba, 2014) with a learning rate of 0.001 and batch size of
128. Training runs for up to 256 epochs with early stopping
if the validation loss had not improved within the last 20
epochs. The model from the epoch with the lowest valida-
tion loss was then selected. Xavier initialization was used
for all weights except for the word embeddings, which used

random uniform initialization with range [−√3,√3]. Both
the embedding and hidden dimensions were of size d = 80.
We used (cid:96)2 regularization on all weights except bias and
used dropout on the initial sentence encodings and the an-

Dynamic Memory Networks for Visual and Textual Question Answering

DMN2
Fusion

(cid:80) gifi AttnGRU AttnGRU

DMN+
Fusion

DMN3
Fusion

GRU
Tied

GRU
Tied

ReLU
Untied

bAbI English 10k dataset

ODMN
GRU

(cid:80) gifi

GRU
Tied

36.0
42.2
0.1
35.7
8.0
1.6
3.3
0.6
3.6
55.1
39.6
9.3
1.9
11.8

Model
Input module
Attention
Mem update
Mem Weights

QA2
QA3
QA5
QA6
QA7
QA8
QA9
QA10
QA14
QA16
QA17
QA18
QA20
Mean error

Accuracy

0.1
19.0
0.5
0.0
2.5
0.1
0.0
0.0
0.7
45.7
5.9
3.8
0.0
3.9

0.7
9.2
0.8
0.6
1.6
0.2
0.0
0.2
0.0
47.9
5.0
0.1
0.0
3.3

0.3
1.1
0.5
0.0
2.4
0.0
0.0
0.0
0.2
45.3
4.2
2.1
0.0
2.8

28.79

Task
2: 2 supporting facts
3: 3 supporting facts
5: 3 argument relations
6: yes/no questions
7: counting
8: lists/sets
9: simple negation
11: basic coreference
14: time reasoning
16: basic induction
17: positional reasoning
18: size reasoning
19: path ﬁnding
Mean error (%)
Failed tasks (err >5%)

DMN+
0.3
1.1
0.5
0.0
2.4
0.0
0.0
0.0
0.2
45.3
4.2
2.1
0.0
2.8
1

E2E NR
0.3
-
-
2.1
-
0.8
-
0.1
2.0
-
-
0.9
-
0.3
-
0.1
0.1
-
-
51.8
0.9
18.6
-
5.3
2.3
1.6
-
4.2
3
-

Table 2. Test error rates of various model architectures on tasks
from the the bAbI English 10k dataset. E2E = End-To-End Mem-
ory Network results from Sukhbaatar et al. (2015). NR = Neu-
ral Reasoner with original auxiliary task from Peng et al. (2015).
DMN+ and E2E achieve an error of 0 on bAbI question sets
(1,4,10,12,13,15,20).

memory update component.
The neural reasoner framework is an end-to-end trainable
model which features a deep architecture for logical rea-
soning and an interaction-pooling mechanism for allowing
interaction over multiple facts. While the neural reasoner
framework was only tested on QA17 and QA19, these were
two of the most challenging question types at the time.
In Table 2 we compare the accuracy of these question an-
swering architectures, both as mean error and error on in-
dividual tasks. The DMN+ model reduces mean error by
1.4% compared to the the end-to-end memory network,
achieving a new state of the art for the bAbI-10k dataset.
One notable deﬁciency in our model is that of QA16: Ba-
sic Induction. In Sukhbaatar et al. (2015), an untied model
using only summation for memory updates was able to
achieve a near perfect error rate of 0.4. When the memory
update was replaced with a linear layer with ReLU activa-
tion, the end-to-end memory network’s overall mean error
decreased but the error for QA16 rose sharply. Our model
experiences the same difﬁculties, suggesting that the more
complex memory update component may prevent conver-
gence on certain simpler tasks.
The neural reasoner model outperforms both the DMN and
end-to-end memory network on QA17: Positional Reason-
ing. This is likely as the positional reasoning task only
involves minimal supervision - two sentences for input,
yes/no answers for supervision, and only 5,812 unique ex-
amples after removing duplicates from the initial 10,000

DAQUAR-ALL visual dataset

27.54

28.43

28.62

rates of various model architectures on
Table 1. Test error
the bAbI-10k dataset,
and accuracy performance on the
DAQUAR-ALL visual dataset. The skipped bAbI questions
(1,4,11,12,13,15,19) achieved 0 error across all models.

swer module, keeping the input with probability p = 0.9.
The last 10% of the training data on each task was chosen
as the validation set. For all tasks, three passes were used
for the episodic memory module, allowing direct compari-
son to other state of the art methods. Finally, we limited the
input to the last 70 sentences for all tasks except QA3 for
which we limited input to the last 130 sentences, similar to
Sukhbaatar et al. (2015).
On some tasks, the accuracy was not stable across multiple
runs. This was particularly problematic on QA3, QA17,
and QA18. To solve this, we repeated training 10 times
using random initializations and evaluated the model that
achieved the lowest validation set loss.
Text QA Results
We compare our best performing approach, DMN+, to two
state of the art question answering architectures: the end to
end memory network (E2E) (Sukhbaatar et al., 2015) and
the neural reasoner framework (NR) (Peng et al., 2015).
Neither approach use supporting facts for training.
The end-to-end memory network is a form of memory net-
work (Weston et al., 2015b) tested on both textual ques-
tion answering and language modeling. The model features
both explicit memory and a recurrent attention mechanism.
We select the model from the paper that achieves the low-
est mean error over the bAbI-10k dataset. This model uti-
lizes positional encoding for input, RNN-style tied weights
for the episode module, and a ReLU non-linearity for the

Dynamic Memory Networks for Visual and Textual Question Answering

test-dev

Y/N Other Num

All

Method
VQA
28.1 64.0
Image
48.1 75.7
Question
52.6 75.6
Q+I
53.7 78.9
LSTM Q+I
ACK
55.7 79.2
iBOWIMG 55.7 76.5
DPPnet
57.2 80.7
57.9 80.5
D-NMN
58.7 79.3
SAN
60.3 80.5
DMN+

test-std
All

-
-
-
54.1
56.0
55.9
57.4
58.0
58.9
60.4

3.8
27.1
37.4
36.4
40.1
42.6
41.7
43.1
46.1
48.3

0.4
36.7
33.7
35.2
36.1
35.0
37.2
37.4
36.6
36.8

classes:
those that utilize a full connected image feature
for classiﬁcation and those that perform reasoning over
multiple small image patches. Only the SAN and DMN
approach use small image patches, while the rest use the
fully-connected whole image feature approach.
Here, we show the quantitative and qualitative results in Ta-
ble 3 and Fig. 6, respectively. The images in Fig. 6 illustrate
how the attention gate gt
i selectively activates over relevant
portions of the image according to the query. In Table 3,
our method outperforms baseline and other state-of-the-art
methods across all question domains (All) in both test-dev
and test-std, and especially for Other questions, achieves a
wide margin compared to the other architectures, which is
likely as the small image patches allow for ﬁnely detailed
reasoning over the image.
However, the granularity offered by small image patches
does not always offer an advantage. The Number questions
may be not solvable for both the SAN and DMN architec-
tures, potentially as counting objects is not a simple task
when an object crosses image patch boundaries.

7. Conclusion
We have proposed new modules for the DMN framework
to achieve strong results without supervision of supporting
facts. These improvements include the input fusion layer
to allow interactions between input facts and a novel at-
tention based GRU that allows for logical reasoning over
ordered inputs. Our resulting model obtains state of the
art results on both the VQA dataset and the bAbI-10k text
question-answering dataset, proving the framework can be
generalized across input domains.

References
Andreas, J., Rohrbach, M., Darrell, T., and Klein, D.
Learning to Compose Neural Networks for Question An-
swering. arXiv preprint arXiv:1601.01705, 2016.

Antol, S., Agrawal, A., Lu, J., Mitchell, M., Batra, D., Zit-
nick, C. L., and Parikh, D. VQA: Visual Question An-
swering. arXiv preprint arXiv:1505.00468, 2015.

Bahdanau, D., Cho, K., and Bengio, Y. Neural machine
translation by jointly learning to align and translate. In
ICLR, 2015.

Bordes, A., Glorot, X., Weston, J., and Bengio, Y. Joint
Learning of Words and Meaning Representations for
Open-Text Semantic Parsing. AISTATS, 2012.

Chen, X. and Zitnick, C. L. Learning a recurrent visual rep-
resentation for image caption generation. arXiv preprint
arXiv:1411.5654, 2014.

Table 3. Performance of various architectures and approaches on
VQA test-dev and test-standard data. VQA numbers are from
Antol et al. (2015); ACK Wu et al. (2015); iBOWIMG -Zhou
et al. (2015); DPPnet - Noh et al. (2015); D-NMN - Andreas et al.
(2016); SAN -Yang et al. (2015)

training examples. Peng et al. (2015) add an auxiliary task
of reconstructing both the original sentences and question
from their representations. This auxiliary task likely im-
proves performance by preventing overﬁtting.

6.3. Comparison to state of the art using VQA

(cid:80)

t∈T i 1(ai==t)

3

i=1 min(

, 1) where 1

(cid:80)N

For the VQA dataset, each question is answered by mul-
tiple people and the answers may not be the same, the
generated answers are evaluated using human consensus.
For each predicted answer ai for the ith question with
target answer set T i, the accuracy of VQA: AccV QA =
(·) is the indica-
1
N
tor function. Simply put, the answer ai is only 100% accu-
rate if at least 3 people provide that exact answer.
Training Details We use the Adam optimizer (Kingma &
Ba, 2014) with a learning rate of 0.003 and batch size of
100. Training runs for up to 256 epochs with early stop-
ping if the validation loss has not improved in the last 10
epochs. For weight initialization, we sampled from a ran-
dom uniform distribution with range [−0.08, 0.08]. Both
the word embedding and hidden layers were vectors of size
d = 512. We apply dropout on the initial image output
from the VGG convolutional neural network (Simonyan &
Zisserman, 2014) as well as the input to the answer module,
keeping input with probability p = 0.5.
Results and Analysis
The VQA dataset is composed of three question domains:
Yes/No, Number, and Other. This enables us to analyze
the performance of the models on various tasks that require
different reasoning abilities.
The comparison models are separated into two broad

Dynamic Memory Networks for Visual and Textual Question Answering

Figure 6. Examples of qualitative results of attention for VQA. The original images are shown on the left. On the right we show how
the attention gate gt
i activates given one pass over the image and query. White regions are the most active. Answers are given by the
DMN+.

Cho, K., van Merrienboer, B., Gulcehre, C., Bahdanau, D.,
Bougares, F., Schwenk, H., and Bengio, Y. Learning
Phrase Representations using RNN Encoder-Decoder for
Statistical Machine Translation. In EMNLP, 2014.

Chung, J., Gulcehre, C., Cho, K., and Bengio, Y. Em-
pirical evaluation of gated recurrent neural networks on
sequence modeling. arXiv preprint arXiv:1412.3555,
2014.

Fang, H., Gupta, S., Iandola, F., Srivastava, R., Deng, L.,
Dollar, P., Gao, J., He, X., Mitchell, M., and Platt, J.
In CVPR,
From captions to visual concepts and back.
2015.

Geman, D., Geman, S., Hallonquist, N., and Younes, L.
A Visual Turing Test for Computer Vision Systems. In
PNAS, 2014.

Graves, A., Wayne, G., and Danihelka, I. Neural turing

machines. arXiv preprint arXiv:1410.5401, 2014.

Iyyer, M., Boyd-Graber, J., Claudino, L., Socher, R., and
Daum´e III, H. A Neural Network for Factoid Question
Answering over Paragraphs. In EMNLP, 2014.

Joulin, A. and Mikolov, T. Inferring algorithmic patterns

with stack-augmented recurrent nets. In NIPS, 2015.

Kaiser, L. and Sutskever, I. Neural GPUs Learn Algo-

rithms. arXiv preprint arXiv:1511.08228, 2015.

Karpathy, A. and Fei-Fei, L. Deep Visual-Semantic Align-
In CVPR,

ments for Generating Image Descriptions.
2015.

Kingma, Diederik and Ba,

Jimmy.
method for stochastic optimization.
arXiv:1412.6980, 2014.

Adam:

A
arXiv preprint

Krizhevsky, A., Sutskever, I., and Hinton, G. E. Imagenet
classiﬁcation with deep convolutional neural networks.
In NIPS, 2012.

Which man is dressed more ﬂamboyantly ?Answer: rightWhat time of day was this picture taken ?Answer: nightWhat is the boy holding ?Answer: surfboardWho is on both photos ?Answer: girlWhat is the main color on the bus ?Answer: blueHow many pink ﬂagsare there ?Answer: 2What is this sculpture made out of ?Answer: metalWhat is the pattern on the cat ' s fur on its tail ?Answer: stripesWhat type of trees are in the background ?Answer: pineDid the player hitthe ball ?Answer: yesWhat color are the bananas ?Answer: greenIs this in the wild ?Answer: noDynamic Memory Networks for Visual and Textual Question Answering

Kulkarni, G., Premraj, V., Dhar, S., Li, S., Choi, Y., Berg,
A. C., and Berg, T. L. Baby talk: Understanding and
generating image descriptions. In CVPR, 2011.

Stollenga, M. F., J. Masci, F. Gomez, and Schmidhuber,
J. Deep Networks with Internal Selective Attention
through Feedback Connections. In NIPS, 2014.

Sukhbaatar, S., Szlam, A., Weston, J., and Fergus, R. End-

to-end memory networks. In NIPS, 2015.

Weston, J., Bordes, A., Chopra, S., and Mikolov, T. To-
wards ai-complete question answering: A set of pre-
requisite toy tasks. arXiv preprint arXiv:1502.05698,
2015a.

Weston, J., Chopra, S., and Bordes, A. Memory networks.

In ICLR, 2015b.

Wu, Q., Wang, P., Shen, C., Hengel, A. van den, and Dick,
A. Ask Me Anything: Free-form Visual Question An-
swering Based on Knowledge from External Sources.
arXiv preprint arXiv:1511.06973, 2015.

Xu, K., Ba, J., Kiros, R., Cho, K., Courville, A. C.,
Salakhutdinov, R., Zemel, R. S., and Bengio, Y. Show,
attend and tell: Neural image caption generation with vi-
sual attention. In ICML, 2015.

Yang, Z., He, X., Gao, J., Deng, L., and Smola, A. Stacked
attention networks for image question answering. arXiv
preprint arXiv:1511.02274, 2015.

Yates, A., Banko, M., Broadhead, M., Cafarella, M. J., Et-
zioni, O., and Soderland, S. Textrunner: Open informa-
tion extraction on the web. In HLT-NAACL (Demonstra-
tions), 2007.

Zhou, B., Tian, Y., Sukhbaatar, S., Szlam, A., and Fergus,
R. Simple baseline for visual question answering. arXiv
preprint arXiv:1512.02167, 2015.

Kumar, A., Irsoy, O., Ondruska, P., Iyyer, M., Bradbury,
J., Gulrajani, I., and Socher, R. Ask Me Anything: Dy-
namic Memory Networks for Natural Language Process-
ing. arXiv preprint arXiv:1506.07285, 2015.

Li, J., Luong, M. T., and Jurafsky, D. A Hierarchical Neu-
ral Autoencoder for Paragraphs and Documents. arXiv
preprint arXiv:1506.01057, 2015.

Lin, T. Y., Maire, M., Belongie, S., Hays, J., Perona, P.,
Ramanan, D., Doll´ar, P., and Zitnick, C. L. Microsoft
In ECCV 2014,
COCO: Common Objects in Context.
2014.

Luong, M. T., Pham, H., and Manning, C. D. Effective ap-
proaches to attention-based neural machine translation.
In EMNLP, 2015.

Ma, L., Lu, Z., and Li, H. Learning to Answer Ques-
tions From Image Using Convolutional Neural Network.
arXiv preprint arXiv:1506.00333, 2015.

Malinowski, M. and Fritz, M. A Multi-World Approach to
Question Answering about Real-World Scenes based on
Uncertain Input. In NIPS, 2014.

Malinowski, M., Rohrbach, M., and Fritz, M. Ask your
neurons: A neural-based approach to answering ques-
tions about images. In ICCV, 2015.

Noh, H., Seo, P. H., and Han, B. Image question answer-
ing using convolutional neural network with dynamic
parameter prediction. arXiv preprint arXiv:1511.05756,
2015.

Peng, B., Lu, Z., Li, H., and Wong, K.

To-
wards neural network-based reasoning. arXiv preprint
arXiv:1508.05508, 2015.

Simonyan, K. and Zisserman, A. Very deep convolu-
tional networks for large-scale image recognition. arXiv
preprint arXiv:1409.1556, 2014.

Socher, R., Chen, D., Manning, C. D., and Ng, A. Y. Rea-
soning With Neural Tensor Networks For Knowledge
Base Completion. In NIPS, 2013a.

Socher, R., Perelygin, A., Wu, J., Chuang, J., Manning,
C., Ng, A., and Potts, C. Recursive deep models for
semantic compositionality over a sentiment treebank. In
EMNLP, 2013b.

Socher, R., Karpathy, A., Le, Q. V., Manning, C. D., and
Ng, A. Y. Grounded compositional semantics for ﬁnding
and describing images with sentences. In ACL, 2014.


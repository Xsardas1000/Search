Feedback Control of Real-Time Display Advertising

Weinan Zhang1, Yifei Rong2,1, Jun Wang1, Tianchi Zhu3, Xiaofan Wang4

1University College London, 2YOYI Inc., 3Big Tree Times Co., 4Shanghai Jiao Tong University

1{w.zhang, j.wang}@cs.ucl.ac.uk, 2yifei.rong@yoyi.com.cn

3tc@bigtree.mobi, 4xfwang@sjtu.edu.cn

6
1
0
2

 
r
a

M
3

 

 
 
]
T
G
.
s
c
[
 
 

1
v
5
5
0
1
0

.

3
0
6
1
:
v
i
X
r
a

ABSTRACT
Real-Time Bidding (RTB) is revolutionising display adver-
tising by facilitating per-impression auctions to buy ad im-
pressions as they are being generated. Being able to use
impression-level data, such as user cookies, encourages user
behaviour targeting, and hence has signiﬁcantly improved
the eﬀectiveness of ad campaigns. However, a fundamental
drawback of RTB is its instability because the bid decision
is made per impression and there are enormous ﬂuctuations
in campaigns’ key performance indicators (KPIs). As such,
advertisers face great diﬃculty in controlling their campaign
performance against the associated costs. In this paper, we
propose a feedback control mechanism for RTB which helps
advertisers dynamically adjust the bids to eﬀectively control
the KPIs, e.g., the auction winning ratio and the eﬀective
cost per click. We further formulate an optimisation frame-
work to show that the proposed feedback control mechanism
also has the ability of optimising campaign performance. By
settling the eﬀective cost per click at an optimal reference
value, the number of campaign’s ad clicks can be maximised
with the budget constraint. Our empirical study based on
real-world data veriﬁes the eﬀectiveness and robustness of
our RTB control system in various situations. The proposed
feedback control mechanism has also been deployed on a
commercial RTB platform and the online test has shown its
success in generating controllable advertising performance.

Keywords
Feedback Control, Demand-Side Platform, Real-Time Bid-
ding, Display Advertising

1.

INTRODUCTION

Emerged in 2009, Real-Time Bidding (RTB) has become a
new paradigm in display advertising [22, 12]. Diﬀerent from
the conventional human negotiation or pre-setting a ﬁxed
price for impressions, RTB creates an impression-level auc-
tion and enables advertisers to bid for individual impression
through computer algorithms served by demand-side plat-
forms (DSPs) [33]. The bid decision could depend on the
evaluation of both the utility (e.g., the likelihood and eco-
nomic value of an impression for generating click or con-
version) and the cost (e.g., the actual paid price) of each ad

WSDM 2016, February 22-25, 2016, San Francisco, CA, USA.
arXiv version.

impression. More importantly, real-time information such as
the speciﬁc user demographics, interest segments and vari-
ous context information is leveraged to help the bidding al-
gorithms evaluate each ad impression. With the real-time
decision making mechanism, it is reported that RTB yields
signiﬁcantly higher return-on-investment (ROI) than other
online advertising forms [31].

Despite the ability of delivering performance-driven adver-
tising, RTB, unfortunately, results in high volatilities, mea-
sured by major Key Performance Indicators (KPIs), such as
CPM (cost per mille), AWR (auction winning ratio), eCPC
(eﬀective cost per click) and CTR (click-through rate). To
illustrate this, Figure 1 plots the four major KPIs over time
for two example campaigns in a real-world RTB dataset. All
four KPIs ﬂuctuate heavily across the time under a widely-
used bidding strategy [25]. Such instability causes advertis-
ers ample diﬃculty in optimising and controlling the KPIs
against their cost.

In this paper, we propose to employ feedback control the-
ory [2] to solve the instability problem in RTB. Feedback
controllers are widely used in various applications for main-
taining dynamically changing variables at the predeﬁned ref-
erence values. The application scenarios range from the
plane direction control [23] to the robot artiﬁcial intelligence
[26]. In our RTB scenario, the speciﬁc KPI value, depend-
ing on the requirements from the advertisers, is regarded as
the variable we want to control with a pre-speciﬁed refer-
ence value. Our study focuses on two use cases.
(i) For
performance-driven advertising, we concern with the feed-
back control of the average cost on acquiring a click, mea-
sured by eﬀective cost per click (eCPC). (ii) For branding
based advertising, to ensure a certain high exposure of a
campaign, we focus on the control of the ratio of winning
the auctions for the targeted impressions, measured by auc-
tion winning ratio (AWR). More speciﬁcally, we take each
of them as the control input signal and consider the gain
(the adjustment value) of bid price as the control output
signal for each incoming ad display opportunity (the bid re-
quest). We develop two controllers to test: the widely used
proportional-integral-derivative (PID) controller [6] and the
waterlevel-based (WL) controller [10]. We conduct large-
scale experiments to test the feedback control performance
with diﬀerent settings of reference value and reference dy-
namics. Through the empirical study, we ﬁnd that the PID
and WL controllers are capable of controlling eCPC and
AWR, while PID further provides a better control accuracy
and robustness than WL.

Furthermore, we investigate whether the proposed feed-
back control can be employed for controllable bid optimi-
sation. It is common that the performance of an ad cam-
paign (e.g., eCPC) varies from diﬀerent channels (e.g., ad
exchanges, user geographic regions and PC/mobile devices)

(cid:176)

(cid:176)

(cid:176) (cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

0.4

R
W
A

0.3

0.2

(cid:176)

(cid:176)

(cid:176)

(cid:176) (cid:176)

15

20

0.1

(cid:176) (cid:176)

(cid:176) (cid:176) (cid:176) (cid:176)

0

5

(cid:176)

(cid:176) (cid:176) (cid:176)

(cid:176)

(cid:176)

10
Hour

0

5

(cid:176)

campaign id

(cid:176) 3358

3476

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176) (cid:176) (cid:176) (cid:176) (cid:176) (cid:176)

(cid:176)

15

20

10
Hour

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

campaign id

(cid:176) 3358

3476

0.010

(cid:176)

(cid:176)

(cid:176)

R
T
C

0.005

(cid:176)

(cid:176)

(cid:176)

M
P
C

100

90

80

70

60

50

75

C
P
C
e

50

25

(cid:176) (cid:176) (cid:176)

(cid:176) (cid:176)

0

(cid:176)

5

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176) (cid:176)

(cid:176) (cid:176) (cid:176) (cid:176)

(cid:176) (cid:176)

(cid:176)

(cid:176) (cid:176)

15

20

10
Hour

0.000

0

5

15

20

10
Hour

Figure 1: The instability of CPM (cost per mille), AWR
(auction winning ratio), eCPC (eﬀective cost per click), and
CTR (click-through rate) for two sample campaigns without
a controller. Dataset: iPinYou.

[34]. If one can reallocate some budget from less cost-eﬀective
channels to more cost-eﬀective ones, the campaign-level per-
formance would improve [35]. In this paper, we formulate
the multi-channel bid optimisation problem and propose a
model to calculate the optimal reference eCPC for each chan-
nel. Our experiments show that the campaign-level click
number and eCPC achieve signiﬁcant improvements with
the same budget.

Moreover, the proposed feedback control mechanism has
been implemented and integrated in a commercial DSP. The
conducted live test shows that in a real and noisy setting
the proposed feedback mechanism has the ability to produce
controllable advertising performance.

To sum up, the contributions of our work are as follows.
(i) We study the instability problem in RTB and investigate
its solution by leveraging the feedback control mechanism.
(ii) Comprehensive oﬄine and online experiments show that
PID controller is better than other alternatives and ﬁnds
the optimal way to settle the variable in almost all studied
cases.
(iii) We further discover that feedback controllers
are of great potential to perform bid optimisation through
settling the eCPC at the reference value calculated by our
proposed mathematical click maximisation framework.

The rest of this paper is organised as follows. Section 2
provides preliminaries for RTB and feedback control. Our
solution is formally presented in Section 3. The empirical
study is reported in Section 4, while the online deployment
and live test are given in Section 5. Section 6 discusses the
related work and we ﬁnally conclude this paper in Section 7.

2. PRELIMINARIES

To make the paper self-contained, in this section, we take
a brief review on the RTB eco-system, bidding strategies,
and some basics of feedback control theory.
2.1 RTB Flow Steps

The interaction process among the main components of
the RTB eco-system is summarised into the following steps:
(0) when a user visits an ad-supported site (e.g., web pages,
streaming videos and mobile apps), each ad placement will
trigger a call for ad (ad request) to the ad exchange. (1)
The ad exchange sends the bid requests for this particular
ad impression to each advertiser’s DSP bidding agent, along
with the available information such as the user and context
information.
(2) With the information of the bid request

and each of its qualiﬁed ads, the bidding agent calculates a
bid price. Then the bid response (ad, bid price) is sent back
to the exchange. (3) Having received the bid responses from
the advertisers, the ad exchange hosts an auction and picks
the ad with the highest bid as the auction winner. (4) Then
the winner is notiﬁed of the auction winning from the ad
exchange. (5) Finally, the winner’s ad will be shown to the
visitor along with the regular content of the publisher’s site.
It is commonly known that a long time page-loading would
greatly reduce users’ satisfactory [22]. Thus, advertiser bid-
ding agents are usually required to return a bid in a very
short time frame (e.g., 100 ms).
(6) The user’s feedback
(e.g., click and conversion) on the displayed ad is tracked
and ﬁnally sent back to the winner advertiser. For a detailed
discussion about RTB eco-systems, we refer to [34, 31]. The
above interaction steps have the corresponding positions in
Figure 2, as we will discuss later.
2.2 Bidding Strategies

A basic problem for DSP bidding agents is to ﬁgure out
how much to bid for an incoming bid request. The bid deci-
sion depends on two factors for each ad impression: the util-
ity (e.g., CTR, expected revenue) and cost (i.e., expected
charged price) [33].
In a widely adopted bidding strategy
[25], the utility is evaluated by CTR estimation while the
base bid price is tuned based on the bid landscape [9] for
the cost evaluation. The generalised bidding strategy in [25]
is

b(t) = b0

θt
θ0

,

(1)

where θt is the estimated CTR for the bid request at moment
t; θ0 is the average CTR under a target condition (e.g., a user
interest segment); and b0 is the tuned base bid price for the
target condition.
In this work, we adopt this widely used
bidding strategy and adopt a logistic CTR estimator [27].
2.3 Feedback Control Theory

Feedback control theory deals with the reaction and con-
trol of dynamic systems from feedback and outside noise [2].
The usual objective of feedback control theory is to control a
dynamic system so that the system output follows a desired
control signal, called the reference, which may be a ﬁxed
or changing value. To attain this objective, a controller is
designed to monitors the output and compares it with the
reference. The diﬀerence between actual and desired output,
called the error factor, is applied as feedback from the dy-
namic system to the control system. With the speciﬁc con-
trol function, the controller outputs the control signal, which
is then transformed by the actuator into the system input
signal sent back to the dynamic system. These processes
form a feedback control loop between the dynamic system
and the controller. Control techniques are widely used in
various engineering applications for maintaining some sig-
nals at the predeﬁned or changing reference values, such as
plane navigation [23] and water distribution control [10].

3. RTB FEEDBACK CONTROL SYSTEM

Figure 2 presents the diagram of the proposed RTB feed-
back control system. The traditional bidding strategy is
represented as the bid calculator module in the DSP bid-
ding agent. The controller plays as a role which adjusts the
bid price from the bid calculator.

Speciﬁcally, the monitor receives the auction win notice
from the ad exchange and the user click feedback from the ad
tracking system, which as a whole we regard as the dynamic
system. Then the current KPI values, such as AWR and

DSP Bidding Agent

Dynamic System

Ad

Bid Calculator

1. Bid 
Request

Controller

Bid Price

Control
Signal

Actuator

Measured
KPI value

Monitor

Control
Function

Error 
factors

Reference

KPI

Adjusted
Bid price

2. Bid 

Response

4. Win
Notice

RTB
Ad

Exchange

3. Auction

0. Ad

Request

5. Ad

Page

6. User Feedback

User

Figure 2: Feedback controller integrated in the RTB system.

eCPC can be calculated. If the task is to control the eCPC
with the reference value, the error factor between the refer-
ence eCPC and the measured eCPC is calculated then sent
into the control function. The output control signal is sent
to the actuator, which uses the control signal to adjust the
original bid price from the bid calculator. The adjusted bid
price is packaged with the qualiﬁed ad into the bid response
and sent back to the ad exchange for auction.
3.1 Actuator

For the bid request at the moment t, the actuator takes
into the current control signal φ(t) to adjust the bid price
from b(t) (Eq. (1)) to a new value ba(t).
In our model,
the control signal, which will be mathematically deﬁned in
the next subsections, is a gain on the bid price. Generally,
when the control signal φ(t) is zero, there should be no bid
adjustment. There could be diﬀerent actuator models, and
in our work we choose to use

ba(t) = b(t) exp{φ(t)},

(2)

where the model satisﬁes ba(t) = b(t) when φ(t) = 0. Other
models such as the linear model ba(t) ≡ b(t)(1 + φ(t)) are
also investigated in our study but it performs poorly in the
situations when a big negative control signal is sent to the
actuator, where the linear actuator will usually respond a
negative or a zero bid, which is meaningless in our scenario.
By contrast, the exponential model is a suitable solution to
addressing the above drawback because it naturally avoids
generating a negative bid. In the later empirical study we
mainly report the analysis based on the exponential-form
actuator model.
3.2 PID Controller

The ﬁrst controller we investigate is the classic PID con-
troller [6]. As its name implies, a PID controller produces
the control signal from a linear combination of the propor-
tional factor, the integral factor and the derivative factor
based on the error factor:

e(tk) = xr − x(tk),

(3)

φ(tk+1) ← λP e(tk) + λI

k

X

j=1

e(tj)△tj + λD

△e(tk)

△tk

,

(4)

where the error factor e(tk) is the reference value xr mi-
nus the current controlled variable value x(tk), the update
time interval is given as △tj = tj − tj−1, the change of er-
ror factors is △e(tk) = e(tk) − e(tk−1), and λP , λI , λD are
the weight parameters for each control factor. Note that
here the control factors are all in discrete time (t1, t2, . . .)
because bidding events are discrete and it is practical to
periodically update the control factors. All control factors
(φ(t), e(tk), λP , λI , λD) remain the same between two up-
dates. Thus for all time t between tk and tk+1, the control
signal φ(t) in Eq. (2) equals φ(tk).We see that P factor tends
to push the current variable value to the reference value; I

Campaign 1458

Campaign 3427

Campaign 3476

C
P
C
e

100

75

50

25

0

C
P
C
e

150

100

50

0

200

150

100

C
P
C
e

50

0

1

2

3

Ad Exchange

1

2

3

Ad Exchange

1

2

3

Ad Exchange

Figure 3: Diﬀerent eCPCs across diﬀerent ad exchanges.
Dataset: iPinYou.

factor reduces the accumulative error from the beginning to
the current time; D factor controls the ﬂuctuation of the
variable.
3.3 Waterlevel-based Controller

The Waterlevel-based (WL) controller is another feedback
control model which was originally used to switching devices
controlled by water level [10]:

φ(tk+1) ← φ(tk) + γ(xr − x(tk)),

(5)

where γ is the step size parameter for φ(tk) update in expo-
nential scale.

Compared to PID, the WL controller only takes the dif-
ference between the variable value and the reference value
into consideration. Moreover, it provides a sequential con-
trol signal. That is, the next control signal is an adjustment
based on the previous one.
3.4 Setting References for Click Maximisation
Given that the feedback controller is an eﬀective tool to
deliver advertisers’ KPI goal, in this subsection, we demon-
strate that the feedback control mechanism can be lever-
aged as a model-free click maximisation framework embed-
ded with any bidding strategies [25, 33] and performs au-
tomatic budget allocation [17] across diﬀerent channels via
setting smart reference values.

When an advertiser speciﬁes the targeted audience (usu-
ally also combined with ad impression contextual categories)
for their speciﬁc campaign, the impressions that ﬁt the tar-
get rules may come from separate channels such as diﬀerent
ad exchanges, user regions, users’ PC/mobile devices etc.
It is common that the DSP integrates with several ad ex-
changes and delivers the required ad impressions from all
those ad exchanges (as long as the impressions ﬁt the tar-
get rule), although the market prices [1] may be signiﬁcantly
diﬀerent. Figure 3 illustrates that, for the same campaign,
there is a diﬀerence in terms of eCPC across diﬀerent ad
exchanges. As pointed out in [34], the diﬀerences are also
found in other channels such as user regions and devices.

The cost diﬀerences provide advertisers a further oppor-
tunity to optimise their campaign performance based on
eCPCs. To see this, suppose a DSP is integrated to two
ad exchanges A and B. For a campaign in this DSP, if its
eCPC from exchange A is higher than that from exchange B,
which means the inventories from exchange B is more cost
eﬀective than those from exchange A, then by reallocating
some budget from exchange A to B will potentially reduce
the overall eCPC of this campaign. Practically the budget
reallocation can be done by reducing the bids for exchange
A while increasing the bids for exchange B. Here we for-
mally propose a model of calculating the equilibrium eCPC
of each ad exchange, which will be used as the optimal refer-
ence eCPC for the feedback control that leads to a maximum
number of clicks given the budget constraint.

Mathematically, suppose for a given ad campaign, there
are n ad exchanges (could be other channels), i.e., 1, 2, . . . , n,
that have the ad volume for a target rule. In our formula-

Campaign 1458

Campaign 3427

Campaign 3476

900

800

s
k
c

i
l

C

700

600

500

700

600

500

s
k
c

i
l

C

400

300

400

300

s
k
c

i
l

C

200

100

We can then rewrite Eq. (12) as

exchange

1

2

3

1
α

= (cid:16)1 +

1

b1 (cid:17)ξ1 = (cid:16)1 +

1

b2 (cid:17)ξ2 = · · · = (cid:16)1 +

1

bn (cid:17)ξn. (16)

Thus ξi =

bi

α(bi + 1)

.

(17)

0

5

10
eCPC

15

20

0

10

20
eCPC

30

40

0

30

60

eCPC

90

120

Figure 4: Number of Clicks against eCPC. Clicks and eCPC
are calculated across the whole iPinYou training dataset of
each campaign by tuning b0 in Eq. (1).

tion we focus on optimising clicks, while the formulation of
conversions can be obtained similarly. Let ξi be the eCPC
on ad exchange i, and ci(ξi) be the click number that the
campaign acquires in the campaign’s lifetime if we tune the
bid price to make its eCPC be ξi for ad exchange i. For
advertisers, they want to maximise the campaign-level click
number given the campaign budget B [33]:

ξ1 ,...,ξn X
max

i

ci(ξi)

s.t. X

i

ci(ξi)ξi = B.

(6)

(7)

Its Lagrangian is
L(ξ1, . . . , ξn, α) = X

i

ci(ξi) − α(X

i

ci(ξi)ξi − B),

(8)

where α is the Lagrangian multiplier. Then we take its gra-
dient on ξi and let it be 0:

∂L(ξ1, . . . , ξn, α)

∂ξi

= c′

i(ξi) − α(c′

i(ξi)ξi + ci(ξi)) = 0,

1
α

=

c′
i(ξi)ξi + ci(ξi)

c′
i(ξi)

= ξi +

ci(ξi)
c′
i(ξi)

,

(9)

(10)

where the equation holds for each ad exchange i. As such, we
can use α to bridge the equations for any two ad exchanges
i and j:

1
α

= ξi +

ci(ξi)
c′
i(ξi)

= ξj +

cj (ξj)
c′
j (ξj)

.

(11)

So the optimal solution condition is given as follows:

1
α

= ξ1 +

c1(ξ1)
c′
1(ξ1)

= ξ2 +

c2(ξ2)
c′
2(ξ2)

= · · · = ξn +

ci(ξi)ξi = B.

X

i

cn(ξn)
c′
n(ξn)

, (12)

(13)

With suﬃcient data instances, we ﬁnd that ci(ξi) is usually
a concave and smooth function. Some examples are given
in Figure 4. Based on the observation, it is reasonable to
deﬁne a general polynomial form of the ci(ξi) functions:

ci(ξi) = c∗

i ai(cid:16) ξi

ξ ∗
i

(cid:17)bi

,

(14)

where ξ ∗
i is the campaign’s historic average eCPC on the ad
inventories from ad exchange i during the training data pe-
riod, and c∗
i is the corresponding click number. These two
factors are directly obtained from the training data. Param-
eters ai and bi are to be tuned to ﬁt the training data.

Substituting Eq. (14) into Eq. (12) gives

1
α

= ξi +

ci(ξi)
c′
i(ξi)

= ξi +

c∗

i ai
bi ξbi

i

c∗

ξ∗
i
i ai
bi biξbi−1
ξ∗
i

i

= (cid:16)1 +

1

bi (cid:17)ξi.

(15)

Interestingly, from Eq. (17) we ﬁnd that the equilibrium is
not in the state that the eCPCs from the exchanges are the
same. Instead, it is when any amount of budget reallocated
among the exchanges does not make any more total clicks;
for instance, in a two-exchange case, the equilibrium reaches
when the increase of the clicks from one exchange equals
the decrease from the other (Eq. (9)). More speciﬁcally,
from Eq. (17) we observe that for ad exchange i, if its click
function ci(ξi) is quite ﬂat, i.e., the click number increases
much slowly as its eCPC increases in a certain area, then
its learned bi should be small. This means the factor
bi +1
is small as well; then from Eq. (17) we can see the optimal
eCPC in ad exchange i should be relatively small.

bi

Substituting Eqs. (14) and (17) into Eq. (7) gives

X

i

c∗
bi (cid:16) bi
i ai
ξ ∗
i

bi + 1(cid:17)bi+1(cid:16) 1

α(cid:17)bi+1

= B,

(18)

where for simplicity, we denote for each ad exchange i, its
parameter c∗
as:

as δi. This give us a simpler form

bi +1(cid:17)bi+1

bi (cid:16) bi

i ai

ξ∗
i

δi(cid:16) 1

α(cid:17)bi+1

X

i

= B.

(19)

There is no closed form to solve Eq. (19) for α. However,
α )bi+1 monotonically in-
as bi cannot be negative and Pi δi( 1
creases against 1
α , one can easily obtain the solution for α by
using a numeric solution such as the stochastic gradient de-
cent or the Newton method [5]. Finally, based on the solved
α, we can ﬁnd the optimal eCPC ξi for each ad exchange i
using Eq. (17). In fact, these eCPCs are the reference value
we want the campaign to achieve for the corresponding ad
exchanges. We can use PID controllers, by setting xr in
Eq. (3) as ξi for each ad exchange i, to achieve these refer-
ence eCPCs so as to achieve the maximum number of clicks
on the campaign level.

As a special case, if we regard the whole volume of the
campaign as one channel, this method can be directly used
as a general bid optimisation tool. It makes use of the cam-
paign’s historic data to decide the optimal eCPC and then
the click optimisation is performed by control the eCPC to
settle at the optimal eCPC as reference. Note that this
multi-channel click maximisation framework is ﬂexible to in-
corporate any bidding strategies.

4. EMPIRICAL STUDY

We conduct comprehensive experiments to study the pro-
posed RTB feedback control mechanism. Our focus in this
section is on oﬄine evaluation using a publicly-available real-
world dataset. To make our experiment repeatable, we have
published the experiment code1. The online deployment and
test on a commercial DSP will be reported in Section 5.
4.1 Evaluation Setup

Dataset. We test our system on a publicly available
dataset collected from iPinYou DSP [19].
It contains the
ad log data from 9 campaigns during 10 days in 2013, which
consists of 64.75M bid records, 19.50M impressions, 14.79K

1https://github.com/wnzhang/rtbcontrol

clicks and 16K Chinese Yuan (CNY) expense. According to
the data publisher [19], the last three-day data of each cam-
paign is split as the test data and the rest as the training
data. The dataset disk size is 35GB. More statistics and
analysis of the dataset is available in [34]. The dataset is
in a record-per-row format, where each row consists of three
parts: (i) The features for this auction, e.g., the time, loca-
tion, IP address, the URL/domain of the publisher, ad slot
size, user interest segments etc. The features of each record
are indexed as a 0.7M-dimension sparse binary vector which
is fed into a logistic regression CTR estimator of the bidding
strategy in Eq. (1); (ii) The auction winning price, which is
the threshold of the bid to win this auction; (iii) The user
feedback on the ad impression, i.e., click or not.

Evaluation Protocol. We follow the evaluation proto-
col from previous studies on bid optimisation [33, 34] and
an RTB contest [19] to run our experiment. Speciﬁcally, for
each data record, we pass the feature information to our bid-
ding agent. Our bidding agent generates a new bid based
on the CTR prediction and other parameters in Eq. (1). We
then compare the generated bid with the logged actual auc-
tion winning price.
If the bid is higher than the auction
winning price, we know the bidding agent has won this auc-
tion, paid the winning price, and obtained the ad impression.
If from the ad impression record there is a click, then the
placement has generated a positive outcome (one click) with
a cost equal to the winning price. If there is no click, the
placement has resulted in a negative outcome and wasted the
money. The control parameters are updated every 2 hours
(as one round).

It is worth mentioning that historical user feedback has
been widely used for evaluating information retrieval sys-
tems [29] and recommender systems [13]. All of them used
historic clicks as a proxy for relevancy to train the predic-
tion model as well as to form the ground truth. Similarly,
our evaluation protocol keeps the user contexts, displayed
ads (creatives etc.), bid requests, and auction environment
unchanged. We intend to answer that under the same con-
text if the advertiser were given a diﬀerent or better bidding
strategy or employed a feedback loop, whether they would
be able to get more clicks with the budget limitation. The
click would stay the same as nothing has been changed for
the users. This methodology works well for evaluating bid
optimisation [1, 33] and has been adopted in the display
advertising industry [19].

Evaluation Measures. We adopt several commonly used
measures in feedback control systems [3]. We deﬁne the error
band as the ±10% interval around the reference value. If the
controlled variable settles within this area, we consider that
the variable is successfully controlled. The speed of conver-
gence (to the reference value) is also important. Speciﬁcally,
we evaluate the rise time to check how fast the controlled
variable will get into the error band. We also use the set-
tling time to evaluate how fast the controlled variable will
be successfully restricted into the error band. However, fast
convergence may bring the problem of inaccurate control.
Thus, two control accuracy measures are introduced. We
use the overshoot to measure the percentage of value that the
controlled variable passes over the reference value. After the
settling (called the steady state), we use the RMSE-SS to
evaluate the root mean square error between the controlled
variable value and the reference value. At last, we measure
the control stability by calculating the standard deviation
of the variable value after the settling, named as SD-SS.

For bid optimisation performance, we use the campaign’s
total achieved click number and eCPC as the prime eval-
uation measures. We also monitor the impression related
performance such as impression number, AWR and CPM.

Table 1: Overall control performance on eCPC.

2261

2259

1458

2821

Cpg. Cntr Rise
1
6
7
6
3
5
17
-
17
-
3
-
9
-
1
-
1
1

PID
WL
PID
WL
PID
WL
PID
WL
PID
WL
PID
WL
PID
WL
PID
WL
PID
WL

2997

3358

3386

3427

3476

Settling Overshoot RMSE-SS
0.0325
0.0845
0.0449
-
0.0299
-
0.0242
-
0.0361
-
0.0337
-
0.0341
-
0.0396
-
0.0327
-

7.73
0
8.03
0
17.66
0
14.47
0
0.75
0
23.89
0
7.90
0
29.03
0
7.64
17.11

5
36
7
-
23
-
22
-
17
-
7
-
13
-
12
-
5
-

SD-SS
0.0313
0.0103
0.0411
-
0.0294
-
0.0216
-
0.026
-
0.0287
-
0.0341
-
0.0332
-
0.031
-

Table 2: Overall control performance on AWR.

2259

1458

2261

2821

Cpg. Cntr Rise
4
3
4
1
1
1
6
1
1
1
2
1
4
1
2
3
2
1

PID
WL
PID
WL
PID
WL
PID
WL
PID
WL
PID
WL
PID
WL
PID
WL
PID
WL

2997

3358

3386

3427

3476

Settling Overshoot RMSE-SS
0.0153
0.0448
0.0076
0.0833
0.0205
-
0.0086
0.0501
0.0151
-
0.0250
0.0332
0.0133
0.0300
0.0200
0.0482
0.0175
0.0308

16.86
0.00
17.08
3.91
16.39
2.02
16.44
5.77
13.68
0.00
22.08
0.13
18.85
2.95
26.63
0.24
27.15
1.49

10
7
6
13
4
-
8
3
8
-
8
7
8
5
6
13
6
7

SD-SS
0.0093
0.0231
0.0072
0.0113
0.0203
-
0.0086
0.0332
0.0151
-
0.0213
0.0211
0.0118
0.0291
0.0179
0.0257
0.0161
0.0271

Empirical Study Organisation. Our empirical study
consists of ﬁve parts with the focus on controlling two KPIs:
eCPC and AWR. (i) In Section 4.2, we answer whether the
proposed feedback control systems are practically capable
of controlling the KPIs. (ii) In Section 4.3, we study the
control diﬃculty with diﬀerent reference value settings. (iii)
In Section 4.4, we focus on the PID controller and investi-
gate its attributes on settling the target variable.
(iv) In
Section 4.5, we leverage the PID controllers as a bid optimi-
sation tool and study their performance on optimising the
campaign’s clicks and eCPC across multiple ad exchanges.
(v) Finally, more discussions about PID parameter tuning
and online update will be given in Section 4.6.
4.2 Control Capability

For each campaign, we check the performance of the two
controllers on two KPIs. We ﬁrst tune the control param-
eters on the training data to minimise the settling time.
Then we adopt the controllers over the test data and ob-
serve the performance. The detailed control performance on
each campaign is provided in Table 1 for eCPC2 and Ta-
ble 2 for AWR. Figure 5 shows the controlled KPI curves
against the timesteps (i.e., round). The dashed horizontal
line means the reference.

We see from the results that (i) all the PID controllers
can settle both KPIs within the error band (with the set-
tling time less than 40 rounds), which indicates that the
PID control is capable of settling both KPIs at the given
reference value. (ii) The WL controller on eCPC does not
work that well on test data, even though we could ﬁnd good
parameters on training data. This is due to the fact that
WL controller tries to aﬀect the average system behaviour
through transient performance feedbacks while facing the

2“-” cells mean invalid because of the failure to rise or settle.

Campaign 1458

Campaign 1458

PID on eCPC

PID on AWR

(cid:176)

(cid:176)

70

60

50

C
P
C
e

40

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)(cid:176)

(cid:176)

(cid:176)(cid:176)

(cid:176)(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)(cid:176)

(cid:176)

(cid:176)

(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)

(cid:176)

1.0

(cid:176)

R
W
A

0.9

0.8

0.7

0.6

0.5

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

0

10

20

round

30

40

0

(cid:176)

(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)

(cid:176)

10

20

round

30

40

controller

(cid:176) PID

WL

(cid:176)

(cid:176)(cid:176)

(cid:176)

C
P
C
e

70

50

30

(cid:176)

(cid:176)(cid:176)(cid:176)

(cid:176)

(cid:176)(cid:176)(cid:176)(cid:176)

(cid:176)

(cid:176)(cid:176)

(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)

(cid:176)(cid:176)

(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)

1.0

(cid:176)

R
W
A

0.8

0.6

0.4

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)

0

10

20

round

30

40

0

10

20

round

30

40

Campaign 3358

Campaign 3358

WL on eCPC

WL on AWR

(cid:176)

160

C
P
C
e

120

80

40

(cid:176)

(cid:176)

(cid:176)(cid:176)

(cid:176)

(cid:176)

(cid:176)(cid:176)

(cid:176)(cid:176)(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)(cid:176)(cid:176)(cid:176)

(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)

1.0

(cid:176)

0.8

R
W
A

0.6

(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)

(cid:176)

(cid:176)

(cid:176)(cid:176)

(cid:176)

(cid:176)(cid:176)

(cid:176)

(cid:176)

controller

(cid:176) PID

WL

C
P
C
e

100

80

60

40

20

(cid:176)

(cid:176)(cid:176)

(cid:176)

(cid:176)

(cid:176)(cid:176)(cid:176)

(cid:176)

(cid:176)(cid:176)(cid:176)(cid:176)

(cid:176)

(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)

(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)

1.0

(cid:176)

R
W
A

0.8

0.6

0.4

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)(cid:176)

(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)

reference

(cid:176) low

middle

high

reference

(cid:176) low

middle

high

0

10

20

round

30

40

0

10

20

round

30

40

Figure 5: Control performance on eCPC and AWR.

i

e
m
T
g
n

 

i
l
t
t

e
S

40

30

20

10

0.05

0.04

0.03

0.02

S
S
−
E
S
M
R

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

0.04

0.03

S
S
−
D
S

0.02

(cid:176)

0.01

low mid

high

Reference

low mid

high

Reference

low mid

high

Reference

(a) PID on eCPC

10.0

7.5

5.0

0.030

0.025

0.020

0.015

0.010

S
S
−
E
S
M
R

(cid:176)

0.025

0.020

0.015

0.010

S
S
−
D
S

i

e
m
T
g
n

 

i
l
t
t

e
S

low mid

high

Reference

low mid high

Reference

low mid high

Reference

(b) PID on AWR

Figure 6: Control diﬃculty comparison with PID.

huge dynamics of RTB. (iii) For WL on AWR, most cam-
paigns are controllable while there are still two campaigns
that fail to settle at the reference value.
(iv) Compared
to PID on AWR, WL always results in higher RMSE-SS
and SD-SS values but lower overshoot percentage. Those
control settings with a fairly short rise time usually face
a higher overshoot.
(v) In addition, we observe that the
campaigns with higher CTR estimator AUC performance
(referring [34]) normally get shorter settling time.

According to above results, PID controller outperforms
the WL controller in the tested RTB cases. We believe this
is due to the fact that the integral factor in PID controller
helps reduce the accumulative error (i.e., RMSE-SS) and the
derivative factor helps reduce the variable ﬂuctuation (i.e.,
SD-SS). And it is easier to settle the AWR than the eCPC.
This is mainly because AWR only depends on the market
price distribution while eCPC additionally involves the user
feedback, i.e., CTR, where the prediction is associated with
signiﬁcant uncertainty.
4.3 Control Difﬁculty

In this section, we extend our control capability experi-
ments further by adding higher and lower reference values in
comparison. Our goal is to investigate the impact of diﬀerent
levels of reference values on control diﬃculty. We follow the
same scheme to train and test the controllers as Section 4.2.
However, instead of showing the exact performance value,
our focus here is on the performance comparison with dif-
ferent reference settings.

0

10

20

round

30

40

0

10

20

round

30

40

Figure 7: Control performance for campaign 3386 on eCPC
and AWR with diﬀerent reference values.

The distribution of achieved settling time, RMSE-SS and
SD-SS, with the setting of three reference levels, i.e., low,
middle and high, are shown in the form of box plot [20] in
the Figure 6(a) and 6(b) for the eCPC and AWR control with
PID. We observe that the average settling time, RMSE-SS
and SD-SS, are reduced as the reference values get higher.
This shows that generally the control tasks with higher ref-
erence eCPC and AWR are easier to achieve because one can
simply bid higher to win more and spend more. Also as the
higher reference is closer to the initial performance value, the
control signal does not bring serious bias or volatility, which
leads to the lower RMSE-SS and SD-SS. For the page limit,
the control performance with WL is not presented here. The
results are similar with PID.

Figure 7 gives the speciﬁc control curves of the two con-
trollers with three reference levels on a sample campaign
3386. We ﬁnd that the reference value which is farthest
away from the initial value of the controlled variable brings
the largest diﬃculty for settling, both on eCPC and AWR.
This suggests that advertisers setting an ambitious control
target will introduce the risk of unsettling or large volatility.
The advertisers should try to ﬁnd a best trade-oﬀ between
the target value and the practical control performance.

4.4 PID Settling: Static vs. Dynamic References

The combination of proportional, integral and derivative
factors enables the PID feedback to automatically adjust the
settling progress during the control lifetime with high eﬃ-
ciency [7]. Alternatively, one can empirically adjust the ref-
erence value in order to achieve the desired reference value.
For example of eCPC control, if the campaign’s achieved
eCPC is higher than the initial reference value right after
exhausting the ﬁrst half budget, the advertiser might want
to lower the reference value in order to accelerate the down-
ward adjustment and ﬁnally reach its initial eCPC target
before running out of the budget. PID feedback controller
implicitly handles such problem via its integration factor [7,
28]. In this section, we investigate with our RTB feedback
control mechanism whether it is still necessary for advertis-
ers to intentionally adjust the reference value according to
the campaign’s real-time performance.

Dynamic Reference Adjustment Model. To simu-
late the advertisers’ strategies to adaptively change the ref-
erence value of eCPC and AWR under the budget constraint,
we propose a dynamic reference adjustment model to calcu-
late the new reference xr(tk+1) after tk:

xr(tk+1) =

(B − s(tk))xrx(tk)
Bx(tk) − s(tk)xr

,

(20)

Campaign 2259

Campaign 2259

350

(cid:176)

(cid:176)(cid:176)(cid:176)

1.0

(cid:176)

R
W
A

0.9

0.8

0.7

0.6

0.5

(cid:176)

(cid:176)(cid:176)

(cid:176)

(cid:176)(cid:176)(cid:176)

(cid:176)

30

40

0

(cid:176)

(cid:176)

(cid:176)

(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)

(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)

(cid:176)(cid:176)

(cid:176)(cid:176)(cid:176)(cid:176)

(cid:176)(cid:176)

0

10

(cid:176)(cid:176)

(cid:176)

(cid:176)

20

round

C
P
C
e

300

250

200

90

80

C
P
C
e

70

60

50

40

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

5

10
round

15

20

(cid:176)

(cid:176)

(cid:176)

(cid:176) (cid:176)

(cid:176)

5

0

Campaign 3427

Campaign 3427

1.0

(cid:176)

(cid:176) (cid:176)

(cid:176)

(cid:176)

(cid:176) (cid:176)

(cid:176)

(cid:176)

(cid:176) (cid:176) (cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176) (cid:176)

(cid:176)

(cid:176)

10
round

15

20

0.8

R
W
A

0.6

(cid:176)

(cid:176)

(cid:176) (cid:176)

(cid:176)

0

5

(cid:176) (cid:176) (cid:176) (cid:176) (cid:176) (cid:176) (cid:176) (cid:176)

(cid:176) (cid:176) (cid:176)

(cid:176) (cid:176)

10
round

15

variable

(cid:176) eCPC/AWR

dynamic−ref

original−ref

variable

(cid:176) eCPC/AWR

dynamic−ref

original−ref

Figure 8: Dynamic reference control with PID.

40

30

20

10

6e+06

t
s
o
C
g
n

 

i
l
t
t

e
S

4e+06

2e+06

0e+00

0.10

0.08

0.06

0.04

S
S
−
E
S
M
R

(cid:176)

(cid:176)

0.05

(cid:176)

(cid:176)

(cid:176)

S
S
−
D
S

0.04

0.03

0.02

0.01

0.00

(cid:176)(cid:176)

(cid:176)

(cid:176)

i

e
m
T
g
n

 

i
l
t
t

e
S

i

e
m
T
g
n

 

i
l
t
t

e
S

dyn
st
Reference

dyn st
Reference

dyn
Reference

st

dyn
Reference

st

(a) PID on eCPC

10

8

6

4

6e+06

t
s
o
C
g
n

 

i
l
t
t

e
S

4e+06

2e+06

(cid:176)(cid:176)

0e+00

(cid:176)

S
S
−
E
S
M
R

0.05

0.04

0.03

0.02

0.01

(cid:176)

0.03

S
S
−
D
S

0.02

0.01

dyn
st
Reference

dyn st
Reference

dyn
Reference

st

dyn
Reference

st

(b) PID on AWR

Figure 9: Dynamic v.s. static reference with PID.

where xr is the initial reference value, x(tk) is the achieved
KPI (eCPC or AWR) at timestep tk, B is the campaign
budget, s(tk) is the cost so far. We can see from Eq. (20)
that when xr(tk) = xr, xr(tk+1) will be set the same as xr;
when xr(tk) > xr, xr(tk+1) will be set lower than xr and
vice versa. For readability, we leave the detailed derivation
in appendix. Using Eq. (20) we calculate the new reference
eCPC/AWR xr(tk+1) and use it to substitute xr in Eq. (3)
to calculated the error factor so as to make the dynamic-
reference control.

Results and Discussions. Figure 8 shows the PID con-
trol performance with dynamic reference calculated based
on Eq. (20). The campaign performance gets stopped at the
point where the budget is exhausted. From the ﬁgure, we see
that for both eCPC and AWR control, the dynamic reference
takes an aggressive approach and pushes the eCPC or AWR
across the original reference value (dashed line). This actu-
ally simulates some advertisers’ strategy: when the perfor-
mance is lower than the reference, then higher the dynamic
reference to push the total performance to the initial refer-
ence more quickly. Furthermore, for AWR control, we can
see the dynamic reference ﬂuctuates seriously when the bud-
get is to be exhausted soon. This is because when there is
insuﬃcient budget left, the reference value will be set much
high or low by Eq. (20) in order to push the performance
back to the initial target. Apparently this is an ineﬀective
solution.

Table 3: Control performance on multi-exchanges with the
reference eCPC set for click maximisation.

2259

1458

Cpg. AdEx Rise
13
15
13
10
3
3
3
7
0
6
3
15
4

1
2
3
1
2
3
1
2
3
1
2
3
4

2261

2821

3358

3386

Settling Cpg. AdEx Rise
9
14
26
6
12
1
16
35
23
18
22
19

1
2
3
1
2
3
1
2
3
1
2
3

3476

3427

26
18
13
38
14
29
30
38
35
17
10
15
38

Settling
20
39
26
18
12
1
16
35
23
29
28
22

Furthermore, we directly compare the quantitative control

performance between dynamic-reference controllers (dyn) with
the standard static-reference ones (st) using PID. Besides the
settling time, we also compare the settling cost, which is the
spent budget before settling. The overall performance across
all the campaigns is shown in Figure 9(a) for eCPC control
and Figure 9(b) for AWR control. The results show that (i)
for eCPC control, the dynamic-reference controllers do not
perform better than the static-reference ones; (ii) for AWR
control, the dynamic-reference controllers could reduce the
settling time and cost, but the accuracy (RMSE-SS) and sta-
bility (SD-SS) is much worse than the static-reference con-
trollers. This is because the dynamic reference itself brings
volatility (see Figure 8). These results demonstrate that
PID controller does perform a good enough way to settling
the variable towards the pre-speciﬁed reference without the
need of dynamically adjusting the reference to accelerate us-
ing our methods. Other dynamic reference models might be
somewhat eﬀective but this is not the focus of this paper.
4.5 Reference Setting for Click Maximisation
We now study how the proposed feedback control could
be used for click optimisation purpose. As we have dis-
cussed in Section 3.4, bid requests usually come from dif-
ferent ad exchanges where the market power and thus the
CPM prices are disparate. We have shown that given a bud-
get constraint, the number of clicks is maximised if one can
control the eCPC in each ad exchange by settling it at an
optimal eCPC reference for each of them, respectively.

In this experiment, we build a PID feedback controller
for each of its integrated ad exchanges, where their refer-
ence eCPCs are calculated via Eqs. (17) and (19). We train
the PID parameters on the training data of each campaign,
and then test the bidding performance on the test data.
As shown in Table 3, the eCPC on all the ad exchanges
for all tested campaigns get settled at the reference values3
(settling time less than 40). We denote our multi-exchange
eCPC feedback control method as multiple. Besides multiple,
we also test a baseline method which assigns a single optimal
uniform eCPC reference across all the ad exchanges, denoted
as uniform. We also use the linear bidding strategy without
feedback control [25] as a baseline, denoted as none4.

The comparisons over various evaluation measures are re-
ported in Figure 10. We observe that (i) the feedback-
control-enabled bidding strategies uniform and multiple sig-
niﬁcantly outperform the non-controlled bidding strategy
none in terms of the number of achieved clicks and eCPC.
This suggests that properly controlling eCPCs would lead
to an optimal solution for maximising clicks. (ii) By reallo-

3Campaign 2997 is only integrated with one ad exchange,
thus not compared here.
4Other bidding strategies [33, 17] are also investigated. Pro-
ducing similar results, they are omitted here for clarity.

50

40

C
P
C
e

30

20

10

0

0.15%

0.10%

R
T
C

0.05%

0.00%

none

uniform multiple

none

uniform multiple

none

uniform multiple

Multiple v.s. None

Multiple v.s. Uniform

8%

6%

4%

2%

0%

t

n
e
m
e
v
o
r
p
m

I
 
k
c

i
l

C

1500

1000

s
k
c

i
l

C

500

0

t

n
e
m
e
v
o
r
p
m

I
 
k
c

i
l

C

150%

100%

50%

0%

i

s
n
o
s
s
e
r
p
m

I

1458 2259 2261 2821 3358 3386 3427 3476 total

1458 2259 2261 2821 3358 3386 3427 3476 total

1.0e+06

7.5e+05

5.0e+05

2.5e+05

0.0e+00

60

M
P
C

40

20

0

0.4

0.3

R
W
A

0.2

0.1

0.0

none uniform multiple

none

uniform multiple

none

uniform multiple

Figure 10: Bid optimisation performance.

Campaign 1458

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176) (cid:176)

(cid:176)

(cid:176)

(cid:176) (cid:176)

(cid:176) (cid:176) (cid:176)

(cid:176)

(cid:176)

(cid:176) (cid:176) (cid:176)

(cid:176) (cid:176) (cid:176) (cid:176) (cid:176) (cid:176) (cid:176) (cid:176) (cid:176) (cid:176) (cid:176)

control

multiple

exchange

(cid:176) 1

2

3

none

uniform

6

4

C
P
C
e

2

0

10

20

round

30

40

Figure 11: Settlement of multi-exchange feedback control.

cating the budget via setting diﬀerent reference eCPCs on
diﬀerent ad exchanges, multiple further outperforms uniform
on 7 out of 8 tested campaigns. (iii) On the impression re-
lated measures, the feedback-control-enabled bidding strate-
gies earn more impressions than the non-controlled bidding
strategy by actively lowering their bids (CPM) and thus
AWR, but achieving more bid volumes. This suggests that
by allocating more budget to the lower valued impressions,
one could potentially generate more clicks. As a by-product,
this conﬁrms the theoretical ﬁnding reported in [33].

As a case study, Figure 11 plots the settling performance of
the three methods on campaign 1458. The three dashed hor-
izontal lines are the reference eCPCs on three ad exchanges.
We see that the eCPCs on the three ad exchanges success-
fully settle at the reference eCPCs. At the same time, the
campaign-level eCPC (multiple) settles at a lower value than
uniform and none.

4.6 PID Parameter Tuning

In this subsection, we share some lessons learned about

PID controller parameter tuning and online update.

Parameter Search. Empirically, λD does not change the
control performance signiﬁcantly. Just a small valued λD,
e.g., 1 × 10−5, will reduce the overshoot and slightly shorten
the settling time. Thus the parameter search is focused on

80

(cid:176)

60

40

C
P
C
e

(cid:176)

(cid:176)

Campaign 1458

Campaign 2997

(cid:176)(cid:176)(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)(cid:176)

(cid:176)(cid:176)

30

(cid:176)

C
P
C
e

25

20

15

10

(cid:176)

(cid:176)

(cid:176)(cid:176)(cid:176)

(cid:176)

(cid:176)

(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)

(cid:176)

(cid:176)

update

(cid:176) offline

online

(cid:176)

(cid:176)(cid:176)

(cid:176)(cid:176)

(cid:176)

(cid:176)

(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)

30

40

20

(cid:176)

(cid:176)(cid:176)

(cid:176)(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)

(cid:176)(cid:176)

(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)

(cid:176)(cid:176)

(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)(cid:176)

0

10

20

round

30

40

0

10

20

round

Figure 12: Control with online/oﬄine parameter updating.

λP and λI . Instead of using the computationally expensive
grid search, we perform an adaptive coordinate search. For
every update, we ﬁx one parameter and shoot another one to
seek for the optimal value leading shortest settling time, and
the line searching step length shrinks exponentially for each
shooting. Normally after 3 or 4 iterations, the local optima
is reached and we ﬁnd such solution is highly comparable
with the expensive grid search.

Setting φ(t) Bounds. We also ﬁnd that setting up up-
per/lower bounds of control signal φ(t) is important to make
KPIs controllable. Due to the dynamics in RTB, it is com-
mon that user CTR drops during a period, which makes
eCPC much higher. The corresponding feedback would prob-
ably result in a large negative gain on the bids, leading ex-
tremely low bid price and thus no win, no click and no ad-
ditional cost at all for remaining rounds.
In such case, a
proper lower bound (-2) of φ(t) aims to eliminate above ex-
treme eﬀects by preventing from a seriously negative control
signal. In addition, an upper bound (5) is used in order to
avoid excessive variable growth beyond the reference value.
Online Parameter Updating. As the DSP running
with feedback control, the collected data can be immedi-
ately utilised for training a new PID controller and updat-
ing the older one. We investigate the possibility of the online
updating of PID parameters with the recent data. Specif-
ically, after initialising the PID parameters using training
data, we re-train the controller for every 10 rounds (i.e., be-
fore round 10, 20 and 30) in the test stage using all previous
data with the same parameter searching method as in the
training stage. The parameter searching in re-training takes
about 10 minutes for each controller, which is far shorter
than the round period (2 hours). Figure 12 shows the control
performance with PID parameters tuned online and oﬄine
respectively. As we can see after the 10th round (i.e., the
ﬁrst online tuning point), the online-tuned PIDs manage to
control the eCPC around the reference value more eﬀectively
than the oﬄine-tuned one, resulting shorter settling time
and lower overshoot.
In addition, no obvious disturbance
or instability occurs when we switch parameters. With the
online parameter updating, we can start to train the con-
trollers based on several-hour training data and adaptively
update the parameters from the new data to improve the
control performance.

5. ONLINE DEPLOYMENT AND TEST

The proposed RTB feedback control system has been de-
ployed and tested in live on BigTree DSP5, a performance-
driven mobile advertising DSP in China. BigTree DSP fo-
cuses on the programmatic buying for optimal advertising
performance on mobile devices, which makes it an ideal place
to test our proposed solution.

The deployment environment is based on Aliyun elastic
cloud computing servers. A three-node cluster is deployed
for the DSP bidding agent, where each node is in Ubuntu
12.04, with 8 core Intel Xeon CPU E5-2630 (2.30GHz) and

5http://www.bigtree.mobi/

Online eCPC control

C
P
C
e

90

80

70

60

50

40

30

20

10

0

2500

2000

variable

1500

reference

s
k
c
i
l
c

eCPC

clicks

1000

500

0

0

12

24

36

48

60

72

84

Hour

Figure 13: The online eCPC control performance and the
accumulative click numbers of a mobile game campaign on
BigTree DSP.

Bids

Impressions

Clicks

CTR

1.000

0.975

0.950

0.925

0.900

1.000

0.975

0.950

0.925

0.900

1.000

0.975

0.950

0.925

0.900

1.000

0.975

0.950

0.925

0.900

none

PID

none

PID

none

PID

none

PID

Figure 14: Relative performance for online test.

8GB RAM. The controller module is implemented in Python
with uWSGI and Nginx.

For BigTree DSP controller module, we deploy the PID
control function and tune its parameters. Speciﬁcally, we
use the last 6-week bidding log data in 2014 as the train-
ing data for tuning PID parameters. A three-fold validation
process is performed to evaluate the generalisation of the
PID control performance, where the previous week data is
used as the training data while the later week data is used
for validation. The control factors (φ(t), e(tk) in Eq. (4)) are
updated for every 90 minutes. After acquiring a set of ro-
bust and eﬀective PID parameters, we launch the controller
module, including the monitor and actuator submodules, on
BigTree DSP.

Figure 13 shows the online eCPC control performance on
one of the iOS mobile game campaigns during 84 hours from
7 Jan. 2015 to 10 Jan. 2015. The reference eCPC is set as
28 RMB cent by the advertiser, which is about 0.8 times the
average eCPC value of the previous week where there was
no control. Following the same training process described
in the previous section, we update the online control factors
for every 90 minutes. From the result we can see the eCPC
value dropped from the beginning 79 cent to 30 during the
ﬁrst day and then settled closed to the reference afterwards.
In the meantime, A/B testing is used to compare with
the non-controlled bidding agent (with the same sampling
rate but disjoint bid requests). Figure 14 shows the cor-
responding advertising performance comparison between a
non-controlled bidding agent and the PID-control bidding
agent during the test period with the same budget. As we
can see, by settling the eCPC value around the lower refer-
ence eCPC, the PID-control bidding agent acquires more
bid volume and win more (higher-CTR) impressions and
clicks, which demonstrates its ability of optimising the per-
formance.

Compared with the oﬄine empirical study, the online run-
ning is more challenging: (i) all pipeline steps including the
update of the CTR estimator, the KPI monitor linked to the
database and the PID controller should operate smoothly
against the market turbulence; (ii) the real market competi-
tion is highly dynamic during the new year period when we
launched our test; (iii) other competitors might tune their
bidding strategies independently or according to any changes
of their performance after we employed the controlled bid-

ding strategy. In sum, the successful eCPC control on an
online commercial DSP veriﬁes the eﬀectiveness of our pro-
posed feedback control RTB system.
6. RELATED WORK

Enabling the impression-level evaluation and bidding, much
research work has been done on RTB display advertising, in-
cluding bidding strategy optimisation [25, 33], reserve price
optimisation [30], ad exchange auction design [4], and ad
tracking [11].

In order to perform the optimal bidding, the DSP bid-
ding agent should estimate both utility and cost of a given
ad impression. The impression-level utility evaluation, in-
cluding CTR and conversion rate (CVR) estimation, is the
essential part for each bidding agent in DSPs. In [18] the
sparsity problem of CVR estimation is handled by mod-
elling the conversions at diﬀerent hierarchical levels. The
user click behaviour on mobile RTB ads is studied in [24].
On the cost evaluation side, bid landscape modelling and
forecasting is much important to inform the bidding agent
about the competitiveness of the market. The authors in
[9] break down the campaign-level bid landscape forecast-
ing problem into “samples” by targeting rules and then em-
ploy a mixture model of log-normal distributions to build
the campaign-level bid landscape. The authors in [16] try
to reduce the bid landscape forecasting error through fre-
quently re-building the landscape models. Based on the
utility and cost evaluation of the ad inventory, bid optimi-
sation is performed to improve the advertising performance
under the campaign budget constraint. Given the estimated
CTR/CVR, the authors in [25, 18] employ linear bidding
functions based on truth-telling attributes of second price
auctions. However, given the budget constraint, the adver-
tisers’ bidding behaviour is not truth-telling. The authors in
[33] propose a general bid optimisation framework to max-
imise the desired advertising KPI (e.g., total click number)
under the budget constraint. Besides the general bid opti-
misation, the explicit bidding rules such as frequency and
recency capping are studied in [31]. Moreover, the budget
pacing [17] which refers to smoothly delivering the campaign
budget is another important problem for DSPs.

There are a few research papers on recommender systems
leveraging feedback controllers for performance maintenance
and improvement. In [21], a rating updating algorithm based
on the PID controller is developed to exclude unfair ratings
in order to build a robust reputation system. The authors
in [32] apply a self-monitoring and self-adaptive approach
to perform a dynamic update of the training data fed into
the recommender system to automatically balance the com-
putational cost and the prediction accuracy. Furthermore,
the authors in [14] adopt the more eﬀective and well-studied
PID controller to the data-feeding scheme of recommender
systems, which is proved to be practically eﬀective in their
studied training task.

Compared to the work of controlling the recommender sys-
tem performance by changing the number of training cases,
our control task in RTB is more challenging, with much vari-
ous dynamics from advertising environment such as the ﬂuc-
tuation of market price, auction volume and user behaviour.
In [8], the authors discuss multiple aspects in a performance-
driven RTB system, where the impression volume control is
one of discussed aspects. Speciﬁcally, WL and a model-
based controller are implemented to control the impression
volume during each time interval. In [15], feedback control
is used to perform budget pacing in order to stablise the
conversion volume. Compared to [8, 15], our work is a more
comprehensive study focused on the feedback control tech-
niques to address the instability problem in RTB. Besides

WL, we intensively investigate the PID controller, which
takes more factors into consideration than WL. For the con-
trolled KPIs, we look into the control tasks on both eCPC
and AWR, which are crucial KPIs for performance-driven
campaigns and branding-based campaigns, respectively. In
addition, we proposed an eﬀective model to calculate the
optimal eCPC reference to maximise the campaign’s clicks
using feedback controllers.

7. CONCLUSIONS

In this paper, we have proposed a feedback control mech-
anism for RTB display advertising, with the aim of improv-
ing its robustness of achieving the advertiser’s KPI goal. We
mainly studied PID and WL controllers for controlling the
eCPC and AWR KPIs. Through our comprehensive empir-
ical study, we have the following discoveries. (i) Despite of
the high dynamics in RTB, the KPI variables are control-
lable using our feedback control mechanism. (ii) Diﬀerent
reference values bring diﬀerent control diﬃculties, which are
reﬂected in the control speed, accuracy and stability. (iii)
PID controller naturally ﬁnds its best way to settle the vari-
able, and there is no necessity to adjust the reference value
for accelerating the PID settling. (iv) By settling the eCPCs
to the optimised reference values, the feedback controller is
capable of making bid optimisation. Deployed on a com-
mercial DSP, the online test demonstrates the eﬀectiveness
of the feedback control mechanism in generating controllable
advertising performance. In the future work, we will further
study the applications based on feedback controllers in RTB,
such as budget pacing and retargeting frequency capping.

8. REFERENCES
[1] K. Amin, M. Kearns, P. Key, and A. Schwaighofer. Budget

optimization for sponsored search: Censored learning in mdps.
UAI, 2012.

[2] K. J. ˚Astr¨om and P. Kumar. Control: A perspective.

Automatica, 50(1):3–43, 2014.

[3] K. J. ˚Astr¨om and R. M. Murray. Feedback systems: an

introduction for scientists and engineers. Princeton university
press, 2010.

[4] S. Balseiro, O. Besbes, and G. Y. Weintraub. Repeated auctions

with budgets in ad exchanges: Approximations and design.
Columbia Business School Research Paper, (12/55), 2014.

[5] R. Battiti. First-and second-order methods for learning:
between steepest descent and newton’s method. Neural
computation, 4(2):141–166, 1992.

[6] S. Bennett. Development of the pid controller. Control

Systems, 13(6):58–62, 1993.

[7] S. P. Bhattacharyya, H. Chapellat, and L. H. Keel. Robust
control. The Parametric Approach, by Prentice Hall PTR,
1995.

[8] Y. Chen, P. Berkhin, B. Anderson, and N. R. Devanur.

Real-time bidding algorithms for performance-based display ad
allocation. KDD, 2011.

[9] Y. Cui, R. Zhang, W. Li, and J. Mao. Bid landscape forecasting

in online ad exchange marketplace. In KDD, pages 265–273.
ACM, 2011.

[10] B. W. Dezotell. Water level controller, June 9 1936. US Patent

2,043,530.

[11] R. Gomer, E. M. Rodrigues, N. Milic-Frayling, and

M. Schraefel. Network analysis of third party tracking: User
exposure to tracking cookies through search. In WI, 2013.

[12] Google. The arrival of real-time bidding. Technical report, 2011.
[13] Y. Hu, Y. Koren, and C. Volinsky. Collaborative ﬁltering for

implicit feedback datasets. In ICDM, 2008.

[14] T. Jambor, J. Wang, and N. Lathia. Using control theory for

stable and eﬃcient recommender systems. In WWW, 2012.

[15] N. Karlsson and J. Zhang. Applications of feedback control in

online advertising. In American Control Conference, 2013.

[16] K. J. Lang, B. Moseley, and S. Vassilvitskii. Handling forecast

errors while bidding for display advertising. In WWW, 2012.

[17] K.-C. Lee, A. Jalali, and A. Dasdan. Real time bid optimization
with smooth budget delivery in online advertising. In ADKDD,
2013.

[18] K.-C. Lee, B. Orten, A. Dasdan, and W. Li. Estimating

conversion rate in display advertising from past performance
data. In KDD, 2012.

[19] H. Liao, L. Peng, Z. Liu, and X. Shen. ipinyou global rtb

bidding algorithm competition dataset. In ADKDD, 2014.

[20] R. McGill, J. W. Tukey, and W. A. Larsen. Variations of box

plots. The American Statistician, 32(1):12–16, 1978.

[21] K. Meng, Y. Wang, X. Zhang, X.-c. Xiao, et al. Control theory

based rating recommendation for reputation systems. In
ICNSC, 2006.

[22] S. Muthukrishnan. Ad exchanges: Research issues. In Internet

and network economics, pages 1–12. Springer, 2009.

[23] R. C. Nelson. Flight stability and automatic control, volume 2.

WCB/McGraw Hill, 1998.

[24] R. J. Oentaryo, E. P. Lim, D. J. W. Low, D. Lo, and

M. Finegold. Predicting response in mobile advertising with
hierarchical importance-aware factorization machine. In
WSDM, 2014.

[25] C. Perlich, B. Dalessandro, R. Hook, O. Stitelman, T. Raeder,

and F. Provost. Bid optimizing and inventory scoring in
targeted online advertising. In KDD, pages 804–812, 2012.

[26] G. Peterson and D. J. Cook. Decision-theoretic layered robotic

control architecture. In AAAI/IAAI, page 976, 1999.

[27] M. Richardson, E. Dominowska, and R. Ragno. Predicting

clicks: estimating the click-through rate for new ads. In WWW,
pages 521–530. ACM, 2007.

[28] D. E. Rivera, M. Morari, and S. Skogestad. Internal model

control: Pid controller design. Industrial & engineering
chemistry process design and development, 25(1), 1986.

[29] J. Xu, C. Chen, G. Xu, H. Li, and E. R. T. Abib. Improving

quality of training data for learning to rank using click-through
data. In WSDM, 2010.

[30] S. Yuan, B. Chen, J. Wang, P. Mason, and S. Seljan. An

Empirical Study of Reserve Price Optimisation in Real-Time
Bidding. In KDD, 2014.

[31] S. Yuan, J. Wang, and X. Zhao. Real-time bidding for online

advertising: measurement and analysis. In ADKDD, 2013.

[32] V. Zanardi and L. Capra. Dynamic updating of online

recommender systems via feed-forward controllers. In SEAMS,
2011.

[33] W. Zhang, S. Yuan, and J. Wang. Optimal real-time bidding for

display advertising. In KDD, 2014.

[34] W. Zhang, S. Yuan, J. Wang, and X. Shen. Real-time bidding

benchmarking with ipinyou dataset. arXiv, 2014.

[35] W. Zhang, Y. Zhang, B. Gao, Y. Yu, X. Yuan, and T.-Y. Liu.

Joint optimization of bid and budget allocation in sponsored
search. In KDD, 2012.

APPENDIX
Reference Adjust Models. Here we provide the detailed
derivation of the proposed dynamic-reference model Eq. (20)
in Section 4.4. We mainly introduce the derivation of ref-
erence eCPC adjustment, while the derivation of reference
AWR adjustment can be obtained similarly.

Let ξr be the initial eCPC target, ξ(tk) be the achieved
eCPC before the moment tk, s(tk) be the total cost so far,
and B be the campaign budget. In such setting, the cur-
rent achieved click number is s(tk)/ξ(tk) and the target click
number is B/ξr. In order to push the overall eCPC to ξr,
i.e., push the total click number B/ξr with the budget B,
the reference eCPC for the remaining time ξr(tk+1) should
satisfy

s(tk)
ξ(tk)

+

B − s(tk)
ξr(tk+1)

=

B
ξr

.

Solving the equation we have

ξr(tk+1) =

(B − s(tk))ξrξ(tk)
Bξ(tk) − s(tk)ξr

.

(21)

(22)

The derivation of reference AWR adjustment is much sim-
ilar but with an extra winning function which links between
the bid price and winning probability [33]. The result for-
mula is just the same as Eq. (22). Using x as a general
notation for eCPC and AWR variables results in Eq. (20) in
Section 4.4.

